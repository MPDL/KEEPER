{% extends "base.html" %}
{% load i18n %}

{% block sub_title %}{% trans "Log In" %} - {% endblock %}
{% block header_css_class %}{% endblock %}
{% block main_css_class %}{% endblock %}
{% block extra_style %}
<style type="text/css">
html, body, #wrapper { height:100%; }
#wrapper {
    background: url('{{ MEDIA_URL }}{{login_bg_image_path}}') center top no-repeat scroll;
    background-size: cover;
    padding-top:1px;
}
#main {
    min-height:0;
}
#lang {
    margin:0;
}
#lang-context {
    font-weight:normal;
}
#lang-context-selector {
    text-align:left;
}
</style>
{% endblock %}

{% block main_content %}
<!--<div class="login-panel-outer-container vh">-->
<div class="container">
    <div class="row">
        <div class="col-lg-7">
            <div id="info_panel">
                <h3>Archive the way you work</h3>
                <div id="intro_en">
                    <p>A new free service for all Max Planck employees and project partners with more than 1TB of storage per user for your researchdata. Profit from safe data storage, seamlessly integrated into your research workflow.</p>
                    <p>You do the right thing - with storing your data in Keeper you can be sure to fulfil the archiving regulations of the Max Planck Society to ensure ‘good scientific practice’.</p>
                    <p>Browse all research projects in KEEPER<span>&nbsp; &nbsp;</span><span><input type="button" title="Only accessible within the Max Planck Society" value="Project Catalog" onclick="window.location='/catalog';"></span></p>
                </div>
                <div id="intro_de">
                    <p>Ein kostenloser Service für alle Max-Planck-Mitarbeiter und Projektpartner mit mehr als 1 TB Speicher pro Nutzer für Ihre Forschungsdaten. Profitieren Sie von einer sicheren Datenspeicherung, nahtlos integriertin Ihrem Forschungsprozess.</p>
                    <p>Sie tun genau das Richtige - mit der Speicherung Ihrer Daten in Keeper können Sie sicher sein, die Archivierungsvorschriften der Max-Planck-Gesellschaft zu erfüllen, und die Regeln zur Sicherung "guter wissenschaftlicher Praxis" einzuhalten.</p>
                    <p>Übersicht aller Forschungsprojekte in KEEPER<span>&nbsp; &nbsp;</span><span><input type="button" title="Only accessible within the Max Planck Society" value="Project Catalog" onclick="window.location='/catalog';"></span></p>
                </div>
         </div>
        </div>
        


<div id="login_panel_parent" class="col-lg-5">
    {#<div class="login-panel">#}
    <div id="login_panel" class="new-narrow-panel">
        {#<h1 class="login-panel-hd">{% trans "Log In" %}</h1>#}
        <h2 class="hd">{% trans "Log In" %}</h2>
        <form action="" method="post" class="con">{% csrf_token %}
            <input type="text" name="login" placeholder="{% trans "Email or Username" %}" aria-label="{% trans "Email or Username" %}" title="{% trans "Email or Username" %}" value="" class="input name-input" /><br />
            <input type="password" name="password" placeholder="{% trans "Password" %}" aria-label="{% trans "Password" %}" title="{% trans "Password" %}" value="" class="input passwd-input" autocomplete="off" />

            {% if form.captcha %}
            <div class="ovhd">
                <span id="refresh-captcha" title="{% trans "Refresh" %}" class="icon-refresh op-icon fright"></span>
                {{ form.captcha }}
            </div>
            {% endif %}

            <input type="hidden" name="next" value="{% if next %}{{ next|escape }}{% else %}{{ SITE_ROOT }}{% endif %}" />
            {% if form.errors %}
            {% if form.captcha.errors %}
            {{ form.captcha.errors}}
            {% elif form.errors.freeze_account %}
            <p class="error">{{ form.errors.freeze_account }}</p>
            {% elif form.errors.inactive %}
            <p class="error">{{ form.errors.inactive }}</p>
            {% else %}
            <p class="error">{% trans "Incorrect email or password" %}</p>
            {% endif %}
             {% else %}
            <p class="error hide"></p>
            {% endif %}

            <label class="checkbox-label remember">
                <input type="checkbox" name="remember_me" class="vam remember-input" />
                <span class="vam">{% blocktrans %}Remember me for {{remember_days}} days {% endblocktrans %}</span>
            </label>
            <button type="submit" class="submit">{% trans "Log In" %}</button>

            <a href="{{ SITE_ROOT }}accounts/password/reset/" class="normal forgot-passwd">{% trans "Forgot password?" %}</a>
        </form>

        <div class="con auth">
            {% if enable_oauth %}
            <a href="{% url 'oauth_login' %}" class="normal">{% trans "Single Sign-On" %}</a>
            {% endif %}

            {% if enable_adfs_login %}
            <a id="adfs-login" href="#" class="normal">ADFS</a>
            {% endif %}

            {% if enable_shib_login %}
            <a id="shib-login" href="#" class="normal">{% trans "Shibboleth" %}</a>
            {% endif %}

            {% if enable_krb5_login %}
            <a id="krb5-login" href="#" class="normal">{% trans "Kerberos" %}</a>
            {% endif %}

            <div class="login-panel-bottom-container">
                {% if enable_signup %}
                <a href="{{ signup_url }}" class="normal fleft" id="sign-up">{% trans "Signup" %}</a>
                {% endif %}
            </div>
        </div> 
    </div>
</div>

    </div>


</div>


    {% include "keeper_footer.html" %}


{% endblock %}

{% block extra_script %}
<script type="text/javascript">
$('.login-panel-outer-container').prepend($($('#logo').html()).attr({'width': 160, 'height':40}).addClass('login-panel-logo'));
$('.login-panel-bottom-container').append($('#lang').removeClass('fright'));

var $el = $('.login-panel-outer-container');
var elHeight = $el.outerHeight();
var wdHeight = $(window).height();
if (wdHeight > elHeight) {
    $el.css({'margin-top': (wdHeight - elHeight)/2});
}
$('#lang').css({'margin-left': $('#sign-up').outerWidth() + 10});
$el.removeClass('vh');

$('#lang-context-selector').css({
    'top': '-' + ($('#lang').offset().top - 5) + 'px',
    'right': 0
});
$('#lang-context-selector .sf-popover-con').css({
    'max-height': $('#lang').offset().top - 10
});

$('[name="login"]').focus();

function setCaptchaInputWidth() {
    $('#id_captcha_1').outerWidth($('.input').outerWidth() - $('.captcha').width() - $('#refresh-captcha').outerWidth(true) - 10);
}
$(window).load(setCaptchaInputWidth);
$('.captcha').load(setCaptchaInputWidth);
$('#refresh-captcha').click(function() {
    $.ajax({
        url: '{% url 'captcha-refresh' %}',
        dataType:'json',
        cache:false,
        success: function(data) {
            $('.captcha').attr('src', data['image_url']);
            $('#id_captcha_0').val(data['key']);
        },
        error: function() {
            $('.error').removeClass('hide').html("{% trans "Failed to refresh the CAPTCHA, please try again later." %}");
        }
    });
    return false;
});

$('input[type="submit"]').click(function(){
    if (!$.trim($('input[name="login"]').val())) {
        $('.error').removeClass('hide').html("{% trans "Email or username cannot be blank" %}");
        return false;
    }
    if (!$.trim($('input[name="password"]').val())) {
        $('.error').removeClass('hide').html("{% trans "Password cannot be blank" %}");
        return false;
    }
});
// set tabindex
$(function() {
    $('input:not([type="hidden"])').each(function(index) {
        $(this).attr('tabindex', index + 1);
    });
});

{% if enable_shib_login %}
$(function() {
    $('#shib-login').click(function() {
        window.location = "{% url 'shib_login' %}{% if next %}?next={{ next|escape }}{% endif %}" + encodeURIComponent(document.location.hash);
        return false;
    });
});
{% endif %}

{% if enable_krb5_login %}
$(function() {
    $('#krb5-login').click(function() {
        window.location = "{% url 'krb5_login' %}{% if next %}?next={{ next|escape }}{% endif %}";
        return false;
    });
});
{% endif %}

{% if enable_adfs_login %}
$(function() {
    $('#adfs-login').click(function() {
        window.location = "{% url 'saml2_login' %}{% if next %}?next={{ next|escape }}{% endif %}";
        return false;
    });
});
{% endif %}

{# KEEPER #}

var lang=$('#lang-context').attr('data-lang');
lang.onchange=translate();
function translate(){
    if(lang == "de"){
        $('#intro_de').show()
        $('#intro_en').hide()
    }else{
        $('#intro_en').show()
        $('#intro_de').hide()
    }	
}

</script>
{% endblock %}
