{"version":3,"sources":["bloxberg-repo-snapshot.js"],"names":["_window$app$pageOptio","window","app","pageOptions","repoID","repoName","checksums","transactionId","commitID","commitTime","commitDesc","commitRelativeTime","showAuthor","authorAvatarURL","authorName","authorNickName","BloxbergRepoSnapshot","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","onSearchedClick","selectedItem","is_dir","url","siteRoot","repo_id","repo_name","path","navigate","repalce","Utils","encodePath","open","location","href","renderFolder","folderPath","setState","folderItems","isLoading","seafileAPI","listCommitDir","then","res","data","dirent_list","catch","error","errorMsg","getErrorMsg","clickFolderPath","e","preventDefault","renderPath","state","pathList","split","_jsxs","React","Fragment","children","_jsx","onClick","bind","_assertThisInitialized","map","item","index","length","slice","join","_createClass","key","value","this","_this$state","isConfirmDialogOpen","className","src","mediaUrl","logoPath","height","logoHeight","width","logoWidth","title","siteTitle","alt","CommonToolbar","dangerouslySetInnerHTML","__html","generateDialogTitle","gettext","concat","encodeURIComponent","Content","Component","_React$Component2","_super2","_this2","theadData","text","_this3","_this$props$data","Loading","FolderItem","_React$Component3","_super3","_this4","handleMouseOver","isIconShown","handleMouseOut","joinPath","name","type","onMouseOver","onMouseOut","getFolderIconUrl","getFileIconUrl","obj_id","target","bytesToSize","size","JSON","parse","download","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/bloxbergRepoSnapshot.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { navigate } from '@reach/router';\nimport { Utils } from './utils/utils';\nimport { gettext, siteRoot, mediaUrl, logoPath, logoWidth, logoHeight, siteTitle } from './utils/constants';\nimport { seafileAPI } from './utils/seafile-api';\nimport Loading from './components/loading';\nimport ModalPortal from './components/modal-portal';\nimport toaster from './components/toast';\nimport CommonToolbar from './components/toolbar/common-toolbar';\n\nimport './css/toolbar.css';\nimport './css/search.css';\n\nimport './css/repo-snapshot.css';\n\nconst { \n  repoID, repoName, checksums, transactionId,\n  commitID, commitTime, commitDesc, commitRelativeTime,\n  showAuthor, authorAvatarURL, authorName, authorNickName\n} = window.app.pageOptions;\n\nclass BloxbergRepoSnapshot extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      errorMsg: '',\n      folderPath: '/',\n      folderItems: [],\n    };\n  }\n\n  componentDidMount() {\n    this.renderFolder(this.state.folderPath);\n  }\n\n  onSearchedClick = (selectedItem) => {\n    if (selectedItem.is_dir === true) {\n      let url = siteRoot + 'library/' + selectedItem.repo_id + '/' + selectedItem.repo_name + selectedItem.path;\n      navigate(url, {repalce: true});\n    } else {\n      let url = siteRoot + 'lib/' + selectedItem.repo_id + '/file' + Utils.encodePath(selectedItem.path);\n      let newWindow = window.open('about:blank');\n      newWindow.location.href = url;\n    }\n  }\n\n  renderFolder = (folderPath) => {\n    this.setState({\n      folderPath: folderPath,\n      folderItems: [],\n      isLoading: true\n    });\n\n    seafileAPI.listCommitDir(repoID, commitID, folderPath).then((res) => {\n      this.setState({\n        isLoading: false,\n        folderItems: res.data.dirent_list\n      });\n    }).catch((error) => {\n      this.setState({\n        isLoading: false,\n        errorMsg: Utils.getErrorMsg(error, true) // true: show login tip if 403\n      }); \n    });\n  }\n\n  clickFolderPath = (folderPath, e) => {\n    e.preventDefault();\n    this.renderFolder(folderPath);\n  }\n\n  renderPath = () => {\n    const path = this.state.folderPath;\n    const pathList = path.split('/');\n\n    if (path == '/') {\n      return repoName;\n    }\n\n    return (\n      <React.Fragment>\n        <a href=\"#\" onClick={this.clickFolderPath.bind(this, '/')}>{repoName}</a>\n        <span> / </span>\n        {pathList.map((item, index) => {\n          if (index > 0 && index != pathList.length - 1) {\n            return (\n              <React.Fragment key={index}>\n                <a href=\"#\" onClick={this.clickFolderPath.bind(this, pathList.slice(0, index+1).join('/'))}>{pathList[index]}</a>\n                <span> / </span>\n              </React.Fragment>\n            );  \n          }\n        }\n        )}  \n        {pathList[pathList.length - 1]} \n      </React.Fragment>\n    );\n  }\n\n  render() {\n    const { isConfirmDialogOpen, folderPath } = this.state;\n\n    return (\n      <React.Fragment>\n        <div className=\"h-100 d-flex flex-column\">\n          <div className=\"top-header d-flex justify-content-between\">\n            <a href={siteRoot}>\n              <img src={mediaUrl + logoPath} height={logoHeight} width={logoWidth} title={siteTitle} alt=\"logo\" />\n            </a>\n            <CommonToolbar onSearchedClick={this.onSearchedClick} />\n          </div>\n          <div className=\"flex-auto container-fluid pt-4 pb-6 o-auto\">\n            <div className=\"row\">\n              <div className=\"col-md-10 offset-md-1\">\n                <h2 dangerouslySetInnerHTML={{__html: Utils.generateDialogTitle(gettext('{placeholder} Snapshot'), repoName) + ` <span class=\"heading-commit-time\">(${commitTime})</span>`}}></h2>\n                {folderPath == '/' && (\n                  <div className=\"d-flex mb-2 align-items-center\">\n                    <p className=\"m-0\">{commitDesc}</p>\n                    <div className=\"ml-4 border-left pl-4 d-flex align-items-center\">\n                      {showAuthor ? (\n                        <React.Fragment>\n                          <img src={authorAvatarURL} width=\"20\" height=\"20\" alt=\"\" className=\"rounded mr-1\" />\n                          <a href={`${siteRoot}profile/${encodeURIComponent(authorName)}/`}>{authorNickName}</a>\n                        </React.Fragment>\n                      ) : <span>{gettext('Unknown')}</span>}\n                      <p className=\"m-0 ml-2\" dangerouslySetInnerHTML={{__html: commitRelativeTime}}></p>\n                    </div>\n                  </div>\n                )}\n                <div className=\"d-flex justify-content-between align-items-center op-bar\">\n                  <p className=\"m-0\">{gettext('Current path: ')}{this.renderPath()}</p>\n                </div>\n                <Content \n                  data={this.state}\n                  renderFolder={this.renderFolder}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n\nclass Content extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.theadData = [\n      {width: '5%', text: ''},\n      {width: '50%', text: gettext('Name')},\n      {width: '15%', text: gettext('Size')},\n      {width: '15%', text: ''},\n      {width: '15%', text: ''}\n    ];\n  } \n\n  render() {\n    const { isLoading, errorMsg, folderPath, folderItems } = this.props.data;\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <p className=\"error mt-6 text-center\">{errorMsg}</p>;\n    }\n\n    return (\n      <table className=\"table-hover\">\n        <thead>\n          <tr>\n            {this.theadData.map((item, index) => {\n              return <th key={index} width={item.width}>{item.text}</th>;\n            })}\n          </tr>\n        </thead>\n        <tbody>\n          {folderItems.map((item, index) => {\n            return <FolderItem \n              key={index}\n              item={item} \n              folderPath={folderPath}\n              renderFolder={this.props.renderFolder}\n            />;\n          })\n          }\n        </tbody>\n      </table>\n    );\n  }\n}\n\nclass FolderItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isIconShown: false\n    };\n  }\n\n  handleMouseOver = () => {\n    this.setState({isIconShown: true});\n  }\n\n  handleMouseOut = () => {\n    this.setState({isIconShown: false});\n  }\n\n  renderFolder = (e) => {\n    e.preventDefault();\n\n    const item = this.props.item;\n    const { folderPath } = this.props;\n    this.props.renderFolder(Utils.joinPath(folderPath, item.name));\n  }\n\n  render() {\n    const item = this.props.item;\n    const { isIconShown } = this.state;\n    const { folderPath } = this.props;\n    return item.type == 'dir' ? (\n      <tr onMouseOver={this.handleMouseOver} onMouseOut={this.handleMouseOut}>\n        <td className=\"text-center\"><img src={Utils.getFolderIconUrl()} alt={gettext('Directory')} width=\"24\" /></td>\n        <td><a href=\"#\" onClick={this.renderFolder}>{item.name}</a></td>\n        <td></td>\n        <td></td>\n      </tr>\n    ) : (\n      <tr onMouseOver={this.handleMouseOver} onMouseOut={this.handleMouseOut}>\n        <td className=\"text-center\"><img src={Utils.getFileIconUrl(item.name)} alt={gettext('File')} width=\"24\" /></td>\n        <td><a href={`${siteRoot}repo/${repoID}/snapshot/files/?obj_id=${item.obj_id}&commit_id=${commitID}&p=${encodeURIComponent(Utils.joinPath(folderPath, item.name))}`} target=\"_blank\">{item.name}</a></td>\n        <td>{Utils.bytesToSize(item.size)}</td>\n        <td className=\"text-center\">\n          <a href={`${siteRoot}api2/bloxberg-pdf/${transactionId}/${JSON.parse(checksums)[Utils.joinPath(folderPath, item.name)]}/?p=${encodeURIComponent(Utils.joinPath(folderPath, item.name))}`} download className={`${isIconShown ? '': 'invisible'}`} title={gettext('Download Certificate')}>{gettext('Download Certificate')}</a>\n        </td>\n        <td className=\"text-center\">\n          <a href={`${siteRoot}repo/${repoID}/${item.obj_id}/download/?file_name=${encodeURIComponent(item.name)}&p=${encodeURIComponent(Utils.joinPath(folderPath, item.name))}`} className={`${isIconShown ? '': 'invisible'}`} title={gettext('Download File')}>{gettext('Download File')}</a>\n        </td>\n      </tr>\n    );\n  }\n}\n\nReactDOM.render(\n  <BloxbergRepoSnapshot />,\n  document.getElementById('wrapper')\n);\n"],"sourceRoot":""}