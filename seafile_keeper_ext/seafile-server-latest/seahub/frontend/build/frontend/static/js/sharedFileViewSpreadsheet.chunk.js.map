{"version":3,"sources":["shared-file-view-spreadsheet.js"],"names":["window","shared","pageOptions","repoID","filePath","err","commitID","fileType","fileName","sharedToken","SharedFileViewSpreadsheet","content","FileContent","React","Component","props","setIframeHeight","e","iframe","currentTarget","height","contentDocument","body","scrollHeight","state","isLoading","errorMsg","queryStatus","seafileAPI","queryOfficeFileConvertStatus","toLowerCase","then","res","data","setState","setTimeout","gettext","catch","error","response","this","className","id","title","src","siteRoot","encodeURIComponent","onLoad","ReactDOM","render","document","getElementById"],"mappings":"2SAaIA,OAAOC,OAAOC,YAFhBC,E,EAAAA,OAAQC,E,EAAAA,SAAUC,E,EAAAA,IAClBC,E,EAAAA,SAAUC,E,EAAAA,SAAUC,E,EAAAA,SAAUC,E,EAAAA,YAG1BC,E,4JACJ,WACE,OACE,cAAC,IAAD,CAAgBC,QAAS,cAACC,EAAD,U,GAHSC,IAAMC,WAQxCF,E,kDAEJ,WAAYG,GAAQ,IAAD,8BACjB,cAAMA,IAqDRC,gBAAkB,SAACC,GACjB,IAAMC,EAASD,EAAEE,cACjBD,EAAOE,OAASF,EAAOG,gBAAgBC,KAAKC,cAtD5C,EAAKC,MAAQ,CACXC,WAAYpB,EACZqB,SAAU,IAJK,E,qDAQnB,WAAqB,IAAD,OAClB,IAAIrB,EAAJ,EAIkB,SAAdsB,IACFC,IAAWC,6BAA6B1B,EAAQG,EAAUF,EAAUG,EAASuB,cAAerB,GAAasB,MAAK,SAACC,GAE7G,OADsBA,EAAIC,KAAJ,QAEpB,IAAK,SACL,IAAK,aACH,EAAKC,SAAS,CACZT,WAAW,IAEbU,WAAWR,EAAa,KACxB,MACF,IAAK,QACH,EAAKO,SAAS,CACZT,WAAW,EACXC,SAAUU,aAAQ,iCAEpB,MACF,IAAK,OACH,EAAKF,SAAS,CACZT,WAAW,EACXC,SAAU,SAGfW,OAAM,SAACC,GACJA,EAAMC,SACR,EAAKL,SAAS,CACZT,WAAW,EACXC,SAAUU,aAAQ,iCAGpB,EAAKF,SAAS,CACZT,WAAW,EACXC,SAAUU,aAAQ,kCAM1BT,M,oBAQF,WAAU,IAAD,EACyBa,KAAKhB,MAA7BC,EADD,EACCA,UAAWC,EADZ,EACYA,SAEnB,OAAIrB,EACK,cAAC,IAAD,IAGLoB,EACK,cAAC,IAAD,IAGLC,EACK,cAAC,IAAD,CAAmBA,SAAUA,IAIpC,qBAAKe,UAAU,8CAAf,SACE,wBAAQC,GAAG,wBAAwBC,MAAOnC,EAAUoC,IAAG,UAAKC,KAAL,iCAAsC1C,EAAtC,YAAgDG,GAAhD,OAA2DwC,mBAAmB1C,GAA9E,6BAA4GK,GAAesC,OAAQP,KAAKxB,wB,GA9E7KH,IAAMC,WAoFhCkC,IAASC,OACP,cAACvC,EAAD,IACAwC,SAASC,eAAe,a","file":"static/js/sharedFileViewSpreadsheet.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { seafileAPI } from './utils/seafile-api';\nimport { siteRoot, gettext } from './utils/constants';\nimport SharedFileView from './components/shared-file-view/shared-file-view';\nimport SharedFileViewTip from './components/shared-file-view/shared-file-view-tip';\nimport Loading from './components/loading';\n\nimport './css/spreadsheet-file-view.css';\n\nconst {\n  repoID, filePath, err,\n  commitID, fileType, fileName, sharedToken\n} = window.shared.pageOptions;\n\nclass SharedFileViewSpreadsheet extends React.Component {\n  render() {\n    return (\n      <SharedFileView content={<FileContent />} />\n    );\n  }\n}\n\nclass FileContent extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: !err,\n      errorMsg: ''\n    };\n  }\n\n  componentDidMount() {\n    if (err) {\n      return;\n    }\n\n    let queryStatus = () => {\n      seafileAPI.queryOfficeFileConvertStatus(repoID, commitID, filePath, fileType.toLowerCase(), sharedToken).then((res) => {\n        const convertStatus = res.data['status'];\n        switch (convertStatus) {\n          case 'QUEUED':\n          case 'PROCESSING':\n            this.setState({\n              isLoading: true\n            });\n            setTimeout(queryStatus, 2000);\n            break;\n          case 'ERROR':\n            this.setState({\n              isLoading: false,\n              errorMsg: gettext('Document convertion failed.')\n            });\n            break;\n          case 'DONE':\n            this.setState({\n              isLoading: false,\n              errorMsg: ''\n            });\n        }\n      }).catch((error) => {\n        if (error.response) {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Document convertion failed.')\n          });\n        } else {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Please check the network.')\n          });\n        }\n      });\n    };\n\n    queryStatus();\n  }\n\n  setIframeHeight = (e) => {\n    const iframe = e.currentTarget;\n    iframe.height = iframe.contentDocument.body.scrollHeight;\n  }\n\n  render() {\n    const { isLoading, errorMsg } = this.state;\n\n    if (err) {\n      return <SharedFileViewTip />;\n    }\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <SharedFileViewTip errorMsg={errorMsg} />;\n    }\n\n    return (\n      <div className=\"shared-file-view-body spreadsheet-file-view\">\n        <iframe id=\"spreadsheet-container\" title={fileName} src={`${siteRoot}office-convert/static/${repoID}/${commitID}${encodeURIComponent(filePath)}/index.html?token=${sharedToken}`} onLoad={this.setIframeHeight}></iframe>\n      </div>\n    );\n  }\n}\n\nReactDOM.render (\n  <SharedFileViewSpreadsheet />,\n  document.getElementById('wrapper')\n);\n"],"sourceRoot":""}