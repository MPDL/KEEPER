(this["webpackJsonpseahub-frontend"]=this["webpackJsonpseahub-frontend"]||[]).push([[11],{1663:function(t,e,a){a(71),t.exports=a(1771)},1664:function(t,e,a){},1771:function(t,e,a){"use strict";a.r(e);var i=a(46),s=a(3),n=a(5),o=a(7),r=a(6),c=a(2),d=a.n(c),l=a(28),h=a.n(l),b=a(83),j=a(4),m=a(8),p=a(1),O=a(114),u=a(19),f=a(118),g=a(67),x=a(12),v=a.n(x),R=a(121),w=a(314),y=a(317),_=a(316),L=a(191),S=a(0);v.a.locale(window.app.config.lang);var C=function(t){Object(o.a)(a,t);var e=Object(r.a)(a);function a(t){var i;return Object(s.a)(this,a),(i=e.call(this,t)).onMouseEnter=function(){i.setState({active:!0})},i.onMouseLeave=function(){i.setState({active:!1})},i.onItemRestore=function(t){t.preventDefault(),i.props.onItemRestore(i.props.item)},i.state={active:!1},i}return Object(n.a)(a,[{key:"render",value:function(){var t=this.props.item,e=R.a.getUrl({type:"download_historic_file",filePath:p.lb,objID:t.rev_file_id}),a="".concat(p.qc,"profile/").concat(encodeURIComponent(t.creator_email),"/"),i="".concat(p.qc,"repo/").concat(p.tb,"/history/files/?obj_id=").concat(t.rev_file_id,"&commit_id=").concat(t.commit_id,"&p=").concat(j.a.encodePath(p.lb)),s="".concat(p.qc,"repo/text_diff/").concat(p.tb,"/?commit=").concat(t.commit_id,"&p=").concat(j.a.encodePath(p.lb)),n="".concat(p.qc,"repo/").concat(p.tb,"/snapshot/?commit_id=").concat(t.commit_id);return Object(S.jsx)(c.Fragment,{children:Object(S.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,className:this.state.active?"tr-highlight":"",children:[Object(S.jsxs)("td",{children:[Object(S.jsx)("span",{children:v()(t.ctime).format("YYYY-MM-DD HH:mm:ss")}),0===this.props.index&&Object(S.jsx)("span",{className:"ml-1",children:Object(p.pb)("(current version)")})]}),Object(S.jsxs)("td",{children:[Object(S.jsx)("img",{className:"avatar",src:t.creator_avatar_url,alt:""})," ",Object(S.jsx)("a",{href:a,target:"_blank",className:"username",children:t.creator_name})]}),Object(S.jsx)("td",{children:j.a.bytesToSize(t.size)}),Object(S.jsx)("td",{children:this.state.active&&Object(S.jsx)(k,{index:this.props.index,downloadUrl:e,viewUrl:i,diffUrl:s,snapshotURL:n,onItemRestore:this.onItemRestore,canDownload:this.props.canDownload,canCompare:this.props.canCompare})})]})})}}]),a}(d.a.Component),k=function(t){Object(o.a)(a,t);var e=Object(r.a)(a);function a(t){var i;return Object(s.a)(this,a),(i=e.call(this,t)).dropdownToggle=function(){i.setState({dropdownOpen:!i.state.dropdownOpen})},i.state={dropdownOpen:!1},i}return Object(n.a)(a,[{key:"render",value:function(){var t=this.props,e=t.index,a=t.downloadUrl,i=t.viewUrl,s=(t.diffUrl,t.snapshotURL),n=t.onItemRestore,o=(t.canCompare,t.canDownload);return Object(S.jsxs)(w.a,{isOpen:this.state.dropdownOpen,toggle:this.dropdownToggle,direction:"down",className:"mx-1 old-history-more-operation",children:[Object(S.jsx)(y.a,{tag:"i",className:"fa fa-ellipsis-v",title:Object(p.pb)("More Operations"),"data-toggle":"dropdown","aria-expanded":this.state.dropdownOpen}),Object(S.jsxs)(_.a,{className:"drop-list",right:!0,children:[0!==e&&Object(S.jsx)("a",{href:"#",onClick:n,children:Object(S.jsx)(L.a,{children:Object(p.pb)("Restore")})}),o&&Object(S.jsx)("a",{href:a,children:Object(S.jsx)(L.a,{children:Object(p.pb)("Download")})}),Object(S.jsx)("a",{href:i,children:Object(S.jsx)(L.a,{children:Object(p.pb)("View")})}),0!=e&&Object(S.jsx)(L.a,{tag:"a",href:s,target:"_blank",children:Object(p.pb)("View Related Snapshot")})]})]})}}]),a}(d.a.PureComponent),N=C,F=(a(221),a(130),a(143),a(1664),function(t){Object(o.a)(a,t);var e=Object(r.a)(a);function a(t){var i;return Object(s.a)(this,a),(i=e.call(this,t)).listNewHistoryRecords=function(t,e){O.a.listFileHistoryRecords(t,1,e).then((function(t){if(!t.data)throw i.setState({isLoading:!1}),Error("There is an error in server.");i.initNewRecords(t.data)}))},i.listOldHistoryRecords=function(t,e){m.b.listOldFileHistoryRecords(t,e).then((function(t){if(!t.data)throw i.setState({isLoading:!1}),Error("There is an error in server.");i.initOldRecords(t.data)}))},i.onScrollHandler=function(t){var e=t.target.clientHeight,a=t.target.scrollHeight,s=e+t.target.scrollTop+1>=a,n=i.state.hasMore;s&&n&&i.reloadMore()},i.reloadMore=function(){if(!i.state.isReloadingData)if(p.Bc){var t=i.state.currentPage+1;i.setState({currentPage:t,isReloadingData:!0}),O.a.listFileHistoryRecords(p.lb,t,p.a).then((function(t){i.updateNewRecords(t.data)}))}else{var e=i.state.nextCommit,a=i.state.filePath,s=i.state.oldFilePath;i.setState({isReloadingData:!0}),s?m.b.listOldFileHistoryRecords(p.tb,s,e).then((function(t){i.updateOldRecords(t.data,s)})):m.b.listOldFileHistoryRecords(p.tb,a,e).then((function(t){i.updateOldRecords(t.data,a)}))}},i.onItemRestore=function(t){var e=t.commit_id,a=t.path;O.a.revertFile(a,e).then((function(t){t.data.success&&(i.setState({isLoading:!0}),i.refershFileList())}))},i.onSearchedClick=function(t){j.a.handleSearchedItemClick(t)},i.state={historyList:[],currentPage:1,hasMore:!1,nextCommit:void 0,filePath:"",oldFilePath:"",isLoading:!0,isReloadingData:!1},i}return Object(n.a)(a,[{key:"componentDidMount",value:function(){p.Bc?this.listNewHistoryRecords(p.lb,p.a):this.listOldHistoryRecords(p.tb,p.lb)}},{key:"initNewRecords",value:function(t){var e=this;if(t.total_count<5)if(t.data.length){var a=t.data[t.data.length-1].commit_id,i=t.data[t.data.length-1].path,s=t.data[t.data.length-1].old_path;i=s||i,m.b.listOldFileHistoryRecords(p.tb,i,a).then((function(a){if(!a.data)throw e.setState({isLoading:!1}),Error("There is an error in server.");e.setState({historyList:t.data.concat(a.data.data.slice(1,a.data.data.length)),isLoading:!1})}))}else m.b.listOldFileHistoryRecords(p.tb,p.lb).then((function(t){if(!t.data)throw e.setState({isLoading:!1}),Error("There is an error in server.");e.setState({historyList:t.data.data,isLoading:!1})}));else this.setState({historyList:t.data,currentPage:t.page,hasMore:t.total_count>p.a*this.state.currentPage,isLoading:!1})}},{key:"initOldRecords",value:function(t){var e=this;t.data.length?this.setState({historyList:t.data,nextCommit:t.next_start_commit,filePath:t.data[t.data.length-1].path,oldFilePath:t.data[t.data.length-1].rev_renamed_old_path,isLoading:!1}):(this.setState({nextCommit:t.next_start_commit}),this.state.nextCommit?m.b.listOldFileHistoryRecords(p.tb,p.lb,this.state.nextCommit).then((function(t){e.initOldRecords(t.data)})):this.setState({isLoading:!1}))}},{key:"updateNewRecords",value:function(t){this.setState({historyList:[].concat(Object(i.a)(this.state.historyList),Object(i.a)(t.data)),currentPage:t.page,hasMore:t.total_count>p.a*this.state.currentPage,isReloadingData:!1})}},{key:"updateOldRecords",value:function(t,e){var a=this;t.data.length?this.setState({historyList:[].concat(Object(i.a)(this.state.historyList),Object(i.a)(t.data)),nextCommit:t.next_start_commit,filePath:t.data[t.data.length-1].path,oldFilePath:t.data[t.data.length-1].rev_renamed_old_path,isReloadingData:!1}):(this.setState({nextCommit:t.next_start_commit}),this.state.nextCommit&&m.b.listOldFileHistoryRecords(p.tb,e,this.state.nextCommit).then((function(t){a.updateOldRecords(t.data,e)})))}},{key:"refershFileList",value:function(){var t=this;p.Bc?O.a.listFileHistoryRecords(p.lb,1,p.a).then((function(e){t.initNewRecords(e.data)})):m.b.listOldFileHistoryRecords(p.tb,p.lb).then((function(e){t.initOldRecords(e.data)}))}},{key:"render",value:function(){var t=this;return Object(S.jsxs)(c.Fragment,{children:[Object(S.jsxs)("div",{id:"header",className:"old-history-header",children:[Object(S.jsx)("div",{className:"logo",children:Object(S.jsx)(f.a,{showCloseSidePanelIcon:!1})}),Object(S.jsx)("div",{className:"toolbar",children:Object(S.jsx)(g.a,{onSearchedClick:this.onSearchedClick})})]}),Object(S.jsx)("div",{id:"main",onScroll:this.onScrollHandler,children:Object(S.jsxs)("div",{className:"old-history-main",children:[Object(S.jsxs)(c.Fragment,{children:[Object(S.jsx)("a",{href:"javascript:window.history.back()",className:"go-back",title:"Back",children:Object(S.jsx)("span",{className:"fas fa-chevron-left"})}),Object(S.jsxs)("h2",{children:[Object(S.jsx)("span",{className:"file-name",children:p.kb})," ",Object(p.pb)("History Versions")]})]}),Object(S.jsxs)(c.Fragment,{children:[Object(S.jsxs)("table",{className:"commit-list",children:[Object(S.jsx)("thead",{children:Object(S.jsxs)("tr",{children:[Object(S.jsx)("th",{width:"40%",children:Object(p.pb)("Time")}),Object(S.jsx)("th",{width:"30%",children:Object(p.pb)("Modifier")}),Object(S.jsx)("th",{width:"25%",children:Object(p.pb)("Size")}),Object(S.jsx)("th",{width:"5%"})]})}),!this.state.isLoading&&Object(S.jsx)("tbody",{children:this.state.historyList.map((function(e,a){return Object(S.jsx)(N,{item:e,index:a,canDownload:p.k,canCompare:p.i,onItemRestore:t.onItemRestore},a)}))})]}),(this.state.isReloadingData||this.state.isLoading)&&Object(S.jsx)(u.a,{}),this.state.nextCommit&&!this.state.isLoading&&!this.state.isReloadingData&&Object(S.jsx)(b.a,{className:"get-more-btn",onClick:this.reloadMore,children:Object(p.pb)("More")})]})]})})]})}}]),a}(d.a.Component));h.a.render(Object(S.jsx)(F,{}),document.getElementById("wrapper"))}},[[1663,1,0]]]);
//# sourceMappingURL=fileHistoryOld.chunk.js.map