{"version":3,"sources":["components/history-list-view/history-list-item.js","components/history-list-view/history-list-view.js","pages/file-history/side-panel.js","pages/file-history/main-panel.js","file-history.js"],"names":["moment","locale","window","app","config","lang","HistoryListItem","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","onMouseEnter","isItemFreezed","setState","isShowOperationIcon","onMouseLeave","onToggleClick","e","isMenuShow","state","onFreezedItemToggle","onItemClick","item","commit_id","currentItem","currentIndex","index","onItemRestore","onItemDownload","_createClass","key","value","this","time","ctime","format","isHigtlightItem","objID","rev_file_id","url","URLDecorator","getUrl","type","filePath","_jsxs","className","concat","onClick","children","_jsx","creator_name","Dropdown","isOpen","toggle","DropdownToggle","tag","alt","gettext","DropdownMenu","DropdownItem","href","onItemDownLoad","React","Component","HistoryListView","componentDidMount","historyList","length","onScrollHandler","event","clientHeight","target","scrollHeight","isBottom","scrollTop","hasMore","reloadMore","preItem","_this2","onScroll","map","HisotyListItem","isReloadingData","Loading","SidePanel","currentPage","editUtilities","listFileHistoryRecords","PER_PAGE","then","res","updateResultState","data","commitId","revertFile","success","isLoading","refershFileList","message","toaster","historyInfo","isError","fileOwner","Error","initResultState","_this3","result","page","total_count","creator_email","_toConsumableArray","MainPanel","_len","arguments","args","Array","_key","apply","onSearchedClick","Prism","highlightAll","renderingContent","DiffViewer","scriptSource","mediaUrl","newMarkdownContent","oldMarkdownContent","FileHistory","searchedItem","Utils","handleSearchedItemClick","setDiffContent","onHistoryItemClick","axios","all","seafileAPI","getFileRevision","historyRepoID","path","spread","res1","getFileContent","content1","content2","Fragment","id","title","fileName","CommonToolbar","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/fileHistory.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport { gettext, filePath } from '../../utils/constants';\nimport URLDecorator from '../../utils/url-decorator';\n\nmoment.locale(window.app.config.lang);\n\nconst propTypes = {\n  index: PropTypes.number.isRequired,\n  item: PropTypes.object.isRequired,\n  currentItem: PropTypes.object,\n  isItemFreezed: PropTypes.bool.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n  onFreezedItemToggle: PropTypes.func.isRequired,\n};\n\nclass HistoryListItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowOperationIcon: false,\n      isMenuShow: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: true});\n    }\n  }\n\n  onMouseLeave = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: false});\n    }\n  }\n\n  onToggleClick = (e) => {\n    this.setState({isMenuShow: !this.state.isMenuShow});\n    this.props.onFreezedItemToggle();\n  }\n\n  onItemClick = () => {\n    this.setState({isShowOperationIcon: false});  //restore to default state\n    if (this.props.item.commit_id === this.props.currentItem.commit_id) {\n      return;\n    }\n    let currentIndex = this.props.index;\n    this.props.onItemClick(this.props.item, currentIndex);\n  }\n\n  onItemRestore = () => {\n    this.props.onItemRestore(this.props.currentItem);\n  }\n\n  onItemDownload = () => {\n    // nothing todo\n  }\n\n  render() {\n    if (!this.props.currentItem) {\n      return '';\n    }\n    let item = this.props.item;\n    let time = moment(item.ctime).format('YYYY-MM-DD HH:mm');\n    let isHigtlightItem = false;\n    if (this.props.item && this.props.currentItem) {\n      isHigtlightItem = this.props.item.commit_id === this.props.currentItem.commit_id;\n    }\n    let objID = this.props.currentItem.rev_file_id;\n    let url = URLDecorator.getUrl({type: 'download_historic_file', filePath: filePath, objID: objID});\n    return (\n      <li\n        className={`history-list-item ${isHigtlightItem ? 'item-active' : ''}`}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n        onClick={this.onItemClick}\n      >\n        <div className=\"history-info\">\n          <div className=\"time\">{time}</div>\n          <div className=\"owner\">\n            <span className=\"squire-icon\"></span>\n            <span>{item.creator_name}</span>\n          </div>\n        </div>\n        <div className=\"history-operation\">\n          <Dropdown isOpen={this.state.isMenuShow} toggle={this.onToggleClick}>\n            <DropdownToggle\n              tag='a'\n              className={`fas fa-ellipsis-v ${(this.state.isShowOperationIcon || isHigtlightItem) ? '' : 'invisible'}`}\n              data-toggle=\"dropdown\"\n              aria-expanded={this.state.isMenuShow}\n              alt={gettext('More Operations')}\n            />\n            <DropdownMenu>\n              {(this.props.index !== 0) && <DropdownItem onClick={this.onItemRestore}>{gettext('Restore')}</DropdownItem>}\n              <DropdownItem tag='a' href={url} onClick={this.onItemDownLoad}>{gettext('Download')}</DropdownItem>\n            </DropdownMenu>\n          </Dropdown>\n        </div>\n      </li>\n    );\n  }\n}\n\nHistoryListItem.propTypes = propTypes;\n\nexport default HistoryListItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport HisotyListItem from './history-list-item';\nimport Loading from '../loading';\n\nconst propTypes = {\n  hasMore: PropTypes.bool.isRequired,\n  isReloadingData: PropTypes.bool.isRequired,\n  historyList: PropTypes.array.isRequired,\n  reloadMore: PropTypes.func.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n};\n\nclass HistoryListView extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isItemFreezed: false,\n      currentItem: null,\n    };\n  }\n\n  componentDidMount = () => {\n    let historyList = this.props.historyList;\n    if (historyList.length > 0) {\n      this.setState({currentItem: historyList[0]});\n      if (historyList === 1) {\n        this.props.onItemClick(historyList[0]);\n      } else {\n        this.props.onItemClick(historyList[0], historyList[1]);\n      }\n    }\n  }\n\n  onFreezedItemToggle = () => {\n    this.setState({isItemFreezed: !this.state.isItemFreezed});\n  }\n\n  onScrollHandler = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop    = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    let hasMore = this.props.hasMore;\n    if (isBottom && hasMore) {\n      this.props.reloadMore();\n    }\n  }\n\n  onItemClick = (item, currentIndex) => {\n    this.setState({currentItem: item});\n    if (currentIndex !== this.props.historyList.length) {\n      let preItem = this.props.historyList[currentIndex + 1];\n      this.props.onItemClick(item, preItem);\n    } else {\n      this.props.onItemClick(item);\n    }\n  }\n\n  render() {\n    return (\n      <ul className=\"history-list-container\" onScroll={this.onScrollHandler}>\n        {this.props.historyList.map((item, index) => {\n          return (\n            <HisotyListItem\n              key={index}\n              item={item}\n              index={index}\n              currentItem={this.state.currentItem}\n              isItemFreezed={this.state.isItemFreezed}\n              onItemClick={this.onItemClick}\n              onItemRestore={this.props.onItemRestore}\n              onFreezedItemToggle={this.onFreezedItemToggle}\n            />\n          );\n        })}\n        {this.props.isReloadingData && <li><Loading /></li>}\n      </ul>\n    );\n  }\n}\n\nHistoryListView.propTypes = propTypes;\n\nexport default HistoryListView;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, PER_PAGE, filePath } from '../../utils/constants';\nimport editUtilities from '../../utils/editor-utilities';\nimport Loading from '../../components/loading';\nimport HistoryListView from '../../components/history-list-view/history-list-view';\nimport toaster from '../../components/toast';\n\nconst propTypes = {\n  onItemClick: PropTypes.func.isRequired,\n};\n\nclass SidePanel extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      historyInfo: '',\n      currentPage: 1,\n      hasMore: false,\n      isLoading: true,\n      isError: false,\n      fileOwner: '',\n      isReloadingData: false,\n    };\n  }\n\n  componentDidMount() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      let historyList = res.data;\n      if (historyList.length === 0) {\n        this.setState({isLoading: false});\n        throw Error('there has an error in server');\n      }\n      this.initResultState(res.data);\n    });\n  }\n\n  refershFileList() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      this.initResultState(res.data);\n    });\n  }\n\n  initResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: result.data,\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email,\n      });\n    }\n  }\n\n  updateResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: [...this.state.historyInfo, ...result.data],\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email\n      });\n    }\n  }\n\n  reloadMore = () => {\n    if (!this.state.isReloadingData) {\n      let currentPage = this.state.currentPage + 1;\n      this.setState({\n        currentPage: currentPage,\n        isReloadingData: true,\n      });\n      editUtilities.listFileHistoryRecords(filePath, currentPage, PER_PAGE).then(res => {\n        this.updateResultState(res.data);\n        this.setState({isReloadingData: false});\n      });\n    }\n  }\n\n  onItemRestore = (currentItem) => {\n    let commitId = currentItem.commit_id;\n    editUtilities.revertFile(filePath, commitId).then(res => {\n      if (res.data.success) {\n        this.setState({isLoading: true});\n        this.refershFileList();\n      }\n      let message = gettext('Successfully restored.');\n      toaster.success(message);\n    });\n  }\n\n  onItemClick =(item, preItem) => {\n    this.props.onItemClick(item, preItem);\n  }\n\n  render() {\n    return (\n      <div className=\"side-panel history-side-panel\">\n        <div className=\"side-panel-center\">\n          <div className=\"history-side-panel-title\">{gettext('History Versions')}</div>\n          <div className=\"history-body\">\n            {this.state.isLoading && <Loading />}\n            {this.state.historyInfo &&\n              <HistoryListView\n                hasMore={this.state.hasMore}\n                isReloadingData={this.state.isReloadingData}\n                historyList={this.state.historyInfo}\n                reloadMore={this.reloadMore}\n                onItemClick={this.onItemClick}\n                onItemRestore={this.onItemRestore}\n              />\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = propTypes;\n\nexport default SidePanel;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Prism from 'prismjs';\nimport { DiffViewer } from '@seafile/seafile-editor';\nimport Loading from '../../components/loading';\nimport { mediaUrl } from '../../utils/constants';\n\nconst contentClass = 'markdown-viewer-render-content';\nconst propTypes = {\n  renderingContent: PropTypes.bool.isRequired,\n  content: PropTypes.string,\n  newMarkdownContent: PropTypes.string.isRequired,\n  oldMarkdownContent: PropTypes.string.isRequired,\n};\n\nclass MainPanel extends React.Component {\n\n  componentDidMount() {\n    Prism.highlightAll();\n  }\n\n  onSearchedClick = () => {\n    //todos;\n  }\n\n  render() {\n    return (\n      <div className=\"main-panel\">\n        <div className=\"main-panel-center content-viewer\">\n          <div className={contentClass}>\n            {\n              this.props.renderingContent ?\n                (<Loading />) :\n                (<div className=\"diff-view article\">\n                  <DiffViewer\n                    scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n                    newMarkdownContent={this.props.newMarkdownContent}\n                    oldMarkdownContent={this.props.oldMarkdownContent}\n                  />\n                </div>)\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nMainPanel.propTypes = propTypes;\n\nexport default MainPanel;\n","import React, { Fragment } from 'react';\nimport ReactDOM from 'react-dom';\nimport axios from 'axios';\nimport { fileName, historyRepoID } from './utils/constants';\nimport { Utils } from './utils/utils';\nimport CommonToolbar from './components/toolbar/common-toolbar';\nimport SidePanel from './pages/file-history/side-panel';\nimport MainPanel from './pages/file-history/main-panel';\nimport { seafileAPI } from './utils/seafile-api';\n\nimport './css/layout.css';\nimport './css/file-history.css';\nimport './css/toolbar.css';\nimport './css/search.css';\n\nclass FileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      renderingContent: true,\n      newMarkdownContent: '',\n      oldMarkdownContent: ''\n    };\n  }\n\n  onSearchedClick = (searchedItem) => {\n    Utils.handleSearchedItemClick(searchedItem);\n  }\n\n  setDiffContent = (newMarkdownContent, oldMarkdownContent)=> {\n    this.setState({\n      renderingContent: false,\n      newMarkdownContent: newMarkdownContent,\n      oldMarkdownContent: oldMarkdownContent,\n    });\n  }\n\n\n  onHistoryItemClick = (item, preItem)=> {\n    this.setState({renderingContent: true});\n    if (preItem) {\n      axios.all([\n        seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path),\n        seafileAPI.getFileRevision(historyRepoID, preItem.commit_id, preItem.path)\n      ]).then(axios.spread((res, res1) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n          seafileAPI.getFileContent(res1.data)\n        ]).then(axios.spread((content1, content2) => {\n          this.setDiffContent(content1.data, content2.data);\n        }));\n      }));\n    } else {\n      seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path).then((res) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n        ]).then(axios.spread((content1) => {\n          this.setDiffContent(content1.data, '');\n        }));\n      });\n    }\n  }\n\n  render() {\n    return(\n      <Fragment>\n        <div id=\"header\" className=\"history-header\">\n          <div className=\"title\">\n            <a href=\"javascript:window.history.back()\" className=\"go-back\" title=\"Back\">\n              <span className=\"fas fa-chevron-left\"></span>\n            </a>\n            <span className=\"name\">{fileName}</span>\n          </div>\n          <div className='toolbar'>\n            <CommonToolbar onSearchedClick={this.onSearchedClick} />\n          </div>\n        </div>\n        <div id=\"main\" className=\"history-content\">\n          <MainPanel\n            newMarkdownContent={this.state.newMarkdownContent}\n            oldMarkdownContent={this.state.oldMarkdownContent}\n            renderingContent={this.state.renderingContent}\n          />\n          <SidePanel onItemClick={this.onHistoryItemClick}/>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nReactDOM.render (\n  <FileHistory />,\n  document.getElementById('wrapper')\n);\n"],"sourceRoot":""}