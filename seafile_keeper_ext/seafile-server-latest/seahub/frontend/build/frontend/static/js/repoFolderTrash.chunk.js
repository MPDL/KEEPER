(this["webpackJsonpseahub-frontend"]=this["webpackJsonpseahub-frontend"]||[]).push([[16],{1757:function(e,t,n){n(48),e.exports=n(1793)},1758:function(e,t,n){},1793:function(e,t,n){"use strict";n.r(t);var r=n(85),s=n(6),a=n(7),c=n(22),o=n(9),i=n(8),l=n(2),d=n.n(l),h=n(20),b=n.n(h),j=n(15),u=n(12),O=n.n(u),m=n(5),p=n(1),f=n(10),g=n(14),x=n(18),v=n(11),D=n(46),M=n(4),F=n(231),k=n.n(F),w=n(0),S=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleInputChange=function(e){r.setState({inputValue:e})},r.formSubmit=function(){var e=r.state.inputValue,t=r.props.repoID;r.setState({submitBtnDisabled:!0}),f.b.deleteRepoTrash(t,e.value).then((function(e){v.a.success(Object(p.nb)("Clean succeeded.")),r.props.refreshTrash(),r.props.toggleDialog()})).catch((function(e){var t=m.a.getErrorMsg(e);r.setState({formErrorMsg:t,submitBtnDisabled:!1})}))},r.options=[{label:Object(p.nb)("3 days ago"),value:3},{label:Object(p.nb)("1 week ago"),value:7},{label:Object(p.nb)("1 month ago"),value:30},{label:Object(p.nb)("all"),value:0}],r.state={inputValue:r.options[0],submitBtnDisabled:!1},r}return Object(a.a)(n,[{key:"render",value:function(){var e=this.state.formErrorMsg;return Object(w.jsxs)(M.u,{isOpen:!0,centered:!0,toggle:this.props.toggleDialog,children:[Object(w.jsx)(M.x,{toggle:this.props.toggleDialog,children:Object(p.nb)("Clean")}),Object(w.jsx)(M.v,{children:Object(w.jsxs)(d.a.Fragment,{children:[Object(w.jsx)("p",{children:Object(p.nb)("Clear files in trash and history\uff1a")}),Object(w.jsx)(k.a,{defaultValue:this.options[0],options:this.options,autoFocus:!1,onChange:this.handleInputChange,placeholder:""}),e&&Object(w.jsx)("p",{className:"error m-0 mt-2",children:e})]})}),Object(w.jsx)(M.w,{children:Object(w.jsx)("button",{className:"btn btn-primary",disabled:this.state.submitBtnDisabled,onClick:this.formSubmit,children:Object(p.nb)("Submit")})})]})}}]),n}(d.a.Component),C=(n(99),n(112),n(1758),window.app.pageOptions),I=C.repoID,_=C.repoFolderName,N=C.path,y=C.enableClean,T=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).getItems=function(e){f.b.getRepoFolderTrash(I,N,e).then((function(e){var t=e.data,n=t.data,s=t.more,a=t.scan_stat;!n.length&&s?r.getItems(a):r.setState({isLoading:!1,items:r.state.items.concat(n),more:s,scanStat:a})})).catch((function(e){r.setState({isLoading:!1,errorMsg:m.a.getErrorMsg(e,!0)})}))},r.getMore=function(){r.setState({isLoading:!0}),r.getItems(r.state.scanStat)},r.onSearchedClick=function(e){if(!0===e.is_dir){var t=p.mc+"library/"+e.repo_id+"/"+e.repo_name+e.path;Object(j.c)(t,{repalce:!0})}else{var n=p.mc+"lib/"+e.repo_id+"/file"+m.a.encodePath(e.path);window.open("about:blank").location.href=n}},r.goBack=function(e){e.preventDefault(),window.history.back()},r.cleanTrash=function(){r.toggleCleanTrashDialog()},r.toggleCleanTrashDialog=function(){r.setState({isCleanTrashDialogOpen:!r.state.isCleanTrashDialogOpen})},r.refreshTrash=function(){r.setState({isLoading:!0,errorMsg:"",items:[],scanStat:null,more:!1,showFolder:!1}),r.getItems()},r.renderFolder=function(e,t,n){r.setState({showFolder:!0,commitID:e,baseDir:t,folderPath:n,folderItems:[],isLoading:!0}),f.b.listCommitDir(I,e,"".concat(t.substr(0,t.length-1)).concat(n)).then((function(e){r.setState({isLoading:!1,folderItems:e.data.dirent_list})})).catch((function(e){e.response?403==e.response.status?r.setState({isLoading:!1,errorMsg:Object(p.nb)("Permission denied")}):r.setState({isLoading:!1,errorMsg:Object(p.nb)("Error")}):r.setState({isLoading:!1,errorMsg:Object(p.nb)("Please check the network.")})}))},r.clickRoot=function(e){e.preventDefault(),r.refreshTrash()},r.clickFolderPath=function(e,t){t.preventDefault();var n=r.state,s=n.commitID,a=n.baseDir;r.renderFolder(s,a,e)},r.renderFolderPath=function(){var e=r.state.folderPath.split("/");return Object(w.jsxs)(d.a.Fragment,{children:[Object(w.jsx)("a",{href:"#",onClick:r.clickRoot,children:_}),Object(w.jsx)("span",{children:" / "}),e.map((function(t,n){if(n>0&&n!=e.length-1)return Object(w.jsxs)(d.a.Fragment,{children:[Object(w.jsx)("a",{href:"#",onClick:r.clickFolderPath.bind(Object(c.a)(r),e.slice(0,n+1).join("/")),children:e[n]}),Object(w.jsx)("span",{children:" / "})]},n)})),e[e.length-1]]})},r.state={isLoading:!0,errorMsg:"",items:[],scanStat:null,more:!1,isCleanTrashDialogOpen:!1},r}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.getItems()}},{key:"render",value:function(){var e,t=this.state,n=t.isCleanTrashDialogOpen,s=t.showFolder;return Object(w.jsxs)(d.a.Fragment,{children:[Object(w.jsxs)("div",{className:"h-100 d-flex flex-column",children:[Object(w.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[Object(w.jsx)("a",{href:p.mc,children:Object(w.jsx)("img",{src:p.Lb+p.Gb,height:p.Fb,width:p.Hb,title:p.nc,alt:"logo"})}),Object(w.jsx)(D.a,{onSearchedClick:this.onSearchedClick})]}),Object(w.jsx)("div",{className:"flex-auto container-fluid pt-4 pb-6 o-auto",children:Object(w.jsx)("div",{className:"row",children:Object(w.jsxs)("div",{className:"col-md-10 offset-md-1",children:[Object(w.jsx)("h2",{children:m.a.generateDialogTitle(Object(p.nb)("{placeholder} Trash"),_)}),Object(w.jsx)("a",(e={href:"#",className:"go-back",title:Object(p.nb)("Back"),onClick:this.goBack,role:"button"},Object(r.a)(e,"role",Object(p.nb)("Back")),Object(r.a)(e,"children",Object(w.jsx)("span",{className:"fas fa-chevron-left"})),e)),Object(w.jsxs)("div",{className:"d-flex justify-content-between align-items-center op-bar",children:[Object(w.jsxs)("p",{className:"m-0",children:[Object(p.nb)("Current path: "),s?this.renderFolderPath():_]}),"/"==N&&y&&!s&&Object(w.jsx)("button",{className:"btn btn-secondary clean",onClick:this.cleanTrash,children:Object(p.nb)("Clean")})]}),Object(w.jsx)(L,{data:this.state,getMore:this.getMore,renderFolder:this.renderFolder})]})})})]}),n&&Object(w.jsx)(x.a,{children:Object(w.jsx)(S,{repoID:I,refreshTrash:this.refreshTrash,toggleDialog:this.toggleCleanTrashDialog})})]})}}]),n}(d.a.Component),L=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).theadData=[{width:"5%",text:""},{width:"45%",text:Object(p.nb)("Name")},{width:"20%",text:Object(p.nb)("Delete Time")},{width:"15%",text:Object(p.nb)("Size")},{width:"15%",text:""}],r}return Object(a.a)(n,[{key:"render",value:function(){var e=this,t=this.props.data,n=t.isLoading,r=t.errorMsg,s=t.items,a=t.more,c=t.showFolder,o=t.commitID,i=t.baseDir,l=t.folderPath,h=t.folderItems;return Object(w.jsxs)(d.a.Fragment,{children:[Object(w.jsxs)("table",{className:"table-hover",children:[Object(w.jsx)("thead",{children:Object(w.jsx)("tr",{children:this.theadData.map((function(e,t){return Object(w.jsx)("th",{width:e.width,children:e.text},t)}))})}),Object(w.jsx)("tbody",{children:c?h.map((function(t,n){return Object(w.jsx)(R,{item:t,commitID:o,baseDir:i,folderPath:l,renderFolder:e.props.renderFolder},n)})):s.map((function(t,n){return Object(w.jsx)(P,{item:t,renderFolder:e.props.renderFolder},n)}))})]}),n&&Object(w.jsx)(g.a,{}),r&&Object(w.jsx)("p",{className:"error mt-6 text-center",children:r}),a&&!n&&!c&&Object(w.jsx)("button",{className:"btn btn-block more mt-6",onClick:this.props.getMore,children:Object(p.nb)("More")})]})}}]),n}(d.a.Component),P=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleMouseOver=function(){r.setState({isIconShown:!0})},r.handleMouseOut=function(){r.setState({isIconShown:!1})},r.restoreItem=function(e){e.preventDefault();var t=r.props.item,n=t.commit_id,s=t.parent_dir+t.obj_name;(t.is_dir?f.b.restoreFolder(I,n,s):f.b.restoreFile(I,n,s)).then((function(e){r.setState({restored:!0}),v.a.success(Object(p.nb)("Successfully restored 1 item."))})).catch((function(e){var t="";t=e.response?e.response.data.error_msg||Object(p.nb)("Error"):Object(p.nb)("Please check the network."),v.a.danger(t)}))},r.renderFolder=function(e){e.preventDefault();var t=r.props.item;r.props.renderFolder(t.commit_id,t.parent_dir,m.a.joinPath("/",t.obj_name))},r.state={restored:!1,isIconShown:!1},r}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props.item,t=this.state,n=t.restored,r=t.isIconShown;return n?null:e.is_dir?Object(w.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Object(w.jsx)("td",{className:"text-center",children:Object(w.jsx)("img",{src:m.a.getFolderIconUrl(),alt:Object(p.nb)("Directory"),width:"24"})}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"#",onClick:this.renderFolder,children:e.obj_name})}),Object(w.jsx)("td",{title:O()(e.deleted_time).format("LLLL"),children:O()(e.deleted_time).format("YYYY-MM-DD")}),Object(w.jsx)("td",{}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"#",className:r?"":"invisible",onClick:this.restoreItem,role:"button",children:Object(p.nb)("Restore")})})]}):Object(w.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Object(w.jsx)("td",{className:"text-center",children:Object(w.jsx)("img",{src:m.a.getFileIconUrl(e.obj_name),alt:Object(p.nb)("File"),width:"24"})}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"".concat(p.mc,"repo/").concat(I,"/trash/files/?obj_id=").concat(e.obj_id,"&commit_id=").concat(e.commit_id,"&base=").concat(encodeURIComponent(e.parent_dir),"&p=").concat(encodeURIComponent("/"+e.obj_name)),target:"_blank",children:e.obj_name})}),Object(w.jsx)("td",{title:O()(e.deleted_time).format("LLLL"),children:O()(e.deleted_time).format("YYYY-MM-DD")}),Object(w.jsx)("td",{children:m.a.bytesToSize(e.size)}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"#",className:r?"":"invisible",onClick:this.restoreItem,role:"button",children:Object(p.nb)("Restore")})})]})}}]),n}(d.a.Component),R=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleMouseOver=function(){r.setState({isIconShown:!0})},r.handleMouseOut=function(){r.setState({isIconShown:!1})},r.renderFolder=function(e){e.preventDefault();var t=r.props.item,n=r.props,s=n.commitID,a=n.baseDir,c=n.folderPath;r.props.renderFolder(s,a,m.a.joinPath(c,t.name))},r.state={isIconShown:!1},r}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props.item,t=(this.state.isIconShown,this.props),n=t.commitID,r=t.baseDir,s=t.folderPath;return"dir"==e.type?Object(w.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[Object(w.jsx)("td",{className:"text-center",children:Object(w.jsx)("img",{src:m.a.getFolderIconUrl(),alt:Object(p.nb)("Directory"),width:"24"})}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"#",onClick:this.renderFolder,children:e.name})}),Object(w.jsx)("td",{}),Object(w.jsx)("td",{}),Object(w.jsx)("td",{})]}):Object(w.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[Object(w.jsx)("td",{className:"text-center",children:Object(w.jsx)("img",{src:m.a.getFileIconUrl(e.name),alt:Object(p.nb)("File"),width:"24"})}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"".concat(p.mc,"repo/").concat(I,"/trash/files/?obj_id=").concat(e.obj_id,"&commit_id=").concat(n,"&base=").concat(encodeURIComponent(r),"&p=").concat(encodeURIComponent(m.a.joinPath(s,e.name))),target:"_blank",children:e.name})}),Object(w.jsx)("td",{}),Object(w.jsx)("td",{children:m.a.bytesToSize(e.size)}),Object(w.jsx)("td",{})]})}}]),n}(d.a.Component);b.a.render(Object(w.jsx)(T,{}),document.getElementById("wrapper"))}},[[1757,1,0]]]);
//# sourceMappingURL=repoFolderTrash.chunk.js.map