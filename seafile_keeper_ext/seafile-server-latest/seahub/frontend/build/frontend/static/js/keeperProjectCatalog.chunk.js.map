{"version":3,"sources":["components/dialog/keeper-catalog-facet-dialog.js","keeper-project-catalog.js"],"names":["KeeperCatalogFacetDialog","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","getTerms","termsChecked","state","termEntries","values","termsSorted","Object","keys","sort","a","b","aLen","length","bLen","localeCompare","filter","t","includes","toggle","toggleDialog","setOrder","e","setState","order","target","value","isSubmitBtnActive","inputSearchTerm","searchTerm","handleCheckboxChange","name","indexOf","addToTermsChecked","addToTerms","handleApply","applyFacet","handleCleanAll","isTermInScope","term","cscope","catalogScope","some","getTermFragment","inputField","idx","_jsx","Fragment","children","FormGroup","className","_jsxs","Label","Input","type","checked","isChecked","onChange","concat","getOrderFragment","o","label","check","gettext","facet","errorMsg","_toConsumableArray","terms","_createClass","key","_this2","this","unshift","_this3","_this4","_this$props","dialogTitle","hasCatalogSearchTerm","_this$state","termsCatalogSearchTermFiltered","Modal","isOpen","ModalHeader","charAt","toUpperCase","slice","ModalBody","Form","style","width","height","placeholder","map","toLowerCase","Alert","color","ModalFooter","Button","onClick","disabled","React","Component","_window$app$pageOptio","window","app","pageOptions","defaultFacet","repoID","repoName","userPerm","KeeperProjectCatalog","doResetFacets","facets","author","_objectSpread","year","institute","director","calculateScopeFromFacets","fs","scope","Set","_i","_Object$keys","f","_step","_iterator","_createForOfIteratorHelper","s","n","done","_step2","tc","_iterator2","add","err","Array","from","updateFacets","newFs","reset","_i2","_Object$keys2","fkey","oldFs","getItems","page","resetScope","setHasTermsChecked","st","keeperAPI","getProjectCatalog","perPage","then","res","d","data","isLoading","currentPage","items","hasNextPage","more","isAccessDenied","is_access_denied","catch","error","Utils","getErrorMsg","resetPerPage","_chk","hasTermsChecked","_defineProperty","cleanAllFacets","onSearchedClick","selectedItem","is_dir","url","siteRoot","repo_id","repo_name","path","navigate","repalce","encodePath","open","location","href","toggleAuthorFacetDialog","isAuthorFacetDialogOpen","toggleYearFacetDialog","isYearFacetDialogOpen","toggleInstituteFacetDialog","isInstituteFacetDialogOpen","toggleDirectorFacetDialog","isDirectorFacetDialogOpen","getFacetFragment","fontWeight","urlParams","URL","searchParams","parseInt","get","script","document","createElement","src","id","async","body","appendChild","_this$state2","hasSearchTerm","Boolean","trim","mediaUrl","logoPath","logoHeight","logoWidth","title","siteTitle","alt","CommonToolbar","fontSize","Content","Paginator","gotoPreviousPage","gotoNextPage","curPerPage","Footer","_React$Component2","_super2","apply","arguments","Loading","item","index","Item","_React$Component3","_super3","toggleDescription","descExpanded","toTitleCase","txt","replace","substr","getAuthors","authors","j","tauthor","tauthors","split","i","push","affs","join","getDirectors","str","dirs","instituteFragment","ins","showExpandDesc","description","is_certified","landing_page_url","catalog_id","substring","maxDescLength","owner","_React$Component4","_super4","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/keeperProjectCatalog.chunk.js","sourcesContent":["import React, { Fragment } from \"react\";\nimport PropTypes from \"prop-types\";\nimport {\n  Alert,\n  Button,\n  Form,\n  FormGroup,\n  Input,\n  Label,\n  Modal,\n  ModalBody,\n  ModalFooter,\n  ModalHeader,\n} from \"reactstrap\";\nimport { gettext } from \"../../utils/constants\";\n\nconst propTypes = {\n  toggleDialog: PropTypes.func.isRequired,\n  name: PropTypes.string.isRequired,\n  values: PropTypes.object.isRequired,\n  catalogScope: PropTypes.arrayOf(PropTypes.number).isRequired,\n  applyFacet: PropTypes.func.isRequired,\n};\n\nconst maxTerms = 30;\n\nclass KeeperCatalogFacetDialog extends React.Component {\n  constructor(props) {\n    super(props);\n    const facet = this.props.values;\n    this.state = {\n      errorMsg: \"\",\n      searchTerm: \"\",\n      isSubmitBtnActive: false,\n      order: facet.order || \"asc\",\n      termsChecked: [...facet.termsChecked] || [],\n    };\n    this.state.terms = this.getTerms();\n  }\n\n  getTerms = () => {\n    const { termsChecked } = this.state;\n    const { termEntries } = this.props.values;\n    // sort terms by amount of entries, desc, and than name, asc\n    let termsSorted = Object.keys(termEntries).sort((a, b) => {\n      let aLen = termEntries[a].length;\n      let bLen = termEntries[b].length;\n      if (aLen == bLen) {\n        return a.localeCompare(b);\n      }\n      return bLen - aLen;\n    });\n    if (termsSorted.length > 0 && termsChecked.length > 0) {\n      termsSorted = termsSorted.filter((t) => !termsChecked.includes(t));\n    }\n    return termsSorted;\n  };\n\n  toggle = () => {\n    this.props.toggleDialog();\n  };\n\n  setOrder = (e) => {\n    this.setState({\n      order: e.target.value,\n      isSubmitBtnActive: true,\n    });\n  };\n\n  inputSearchTerm = (e) => {\n    this.setState({ searchTerm: e.target.value });\n  };\n\n  addToTermsChecked(name) {\n    this.state.termsChecked.unshift(name);\n    this.setState(\n      {\n        termsChecked: this.state.termsChecked,\n      },\n      () => {\n        this.setState({ terms: this.getTerms() });\n      }\n    );\n  }\n\n  addToTerms(name) {\n    let { termsChecked } = this.state;\n    termsChecked = termsChecked.filter((t) => t !== name);\n    this.setState(\n      {\n        termsChecked: termsChecked,\n      },\n      () => {\n        this.setState({ terms: this.getTerms() });\n      }\n    );\n  }\n\n  isChecked(name) {\n    return this.state.termsChecked.indexOf(name) != -1;\n  }\n\n  handleCheckboxChange = (e) => {\n    const name = e.target.name;\n    if (this.state.termsChecked.indexOf(name) == -1) {\n      this.addToTermsChecked(name);\n    } else {\n      this.addToTerms(name);\n    }\n    this.setState({ isSubmitBtnActive: true, searchTerm: \"\" });\n  };\n\n  handleApply = () => {\n    this.props.applyFacet(\n      this.props.name,\n      this.state.termsChecked,\n      this.state.order\n    );\n    this.toggle();\n  };\n\n  handleCleanAll = () => {\n    this.props.applyFacet(this.props.name, [], \"asc\");\n    this.toggle();\n  };\n\n  isTermInScope = (term) => {\n    const cscope = this.props.catalogScope || [];\n    if (cscope.length == 0) return true;\n    const tscope = this.props.values.termEntries[term];\n    return tscope.some((e) => cscope.includes(e));\n  };\n\n  getTermFragment = (inputField, idx) => {\n    let { termEntries } = this.props.values;\n    // if (!this.isTermInScope(inputField))\n    //   return\n    return (\n      <Fragment key={`${inputField}~${idx}`}>\n        <FormGroup className=\"ml-5 mb-0\">\n          <Label>\n            <Input\n              type=\"checkbox\"\n              name={inputField}\n              checked={this.isChecked(inputField)}\n              onChange={this.handleCheckboxChange}\n            />\n            {inputField + \" (\" + termEntries[inputField].length + \")\"}\n          </Label>\n        </FormGroup>\n      </Fragment>\n    );\n  };\n\n  getOrderFragment = (o, label) => {\n    return (\n      <FormGroup check>\n        <Label check>\n          <Input\n            type=\"radio\"\n            name=\"order\"\n            value={o}\n            checked={this.state.order == o}\n            onChange={this.setOrder}\n            className=\"mr-1\"\n          />\n          {gettext(label)}\n        </Label>\n      </FormGroup>\n    );\n  };\n\n  render() {\n    const { dialogTitle, name, hasCatalogSearchTerm } = this.props;\n    const { errorMsg, searchTerm, termsChecked, terms, isSubmitBtnActive } =\n      this.state;\n\n    let termsCatalogSearchTermFiltered = hasCatalogSearchTerm\n      ? terms.filter((term) => this.isTermInScope(term))\n      : terms;\n\n    return (\n      <Modal isOpen={true} toggle={this.toggle}>\n        <ModalHeader toggle={this.toggle}>\n          {gettext(\n            \"Select \" + name.charAt(0).toUpperCase() + name.slice(1) + \"(s)\"\n          )}\n        </ModalHeader>\n        <ModalBody>\n          <Form>\n            {this.getOrderFragment(\"asc\", \"Ascending\")}\n            {this.getOrderFragment(\"desc\", \"Descending\")}\n            <FormGroup className=\"mt-3\">\n              <Input\n                style={{ width: \"60%\", height: \"60%\" }}\n                placeholder={gettext(\"Search\")}\n                value={searchTerm}\n                onChange={this.inputSearchTerm}\n              />\n            </FormGroup>\n            {termsChecked.map((term, idx) => this.getTermFragment(term, idx))}\n            {termsCatalogSearchTermFiltered\n              .filter(\n                (term) =>\n                  typeof searchTerm === \"undefined\" ||\n                  searchTerm === null ||\n                  (term &&\n                    term.toLowerCase().includes(searchTerm.toLowerCase()))\n              )\n              .map(\n                (term, idx) =>\n                  idx + termsChecked.length < maxTerms &&\n                  this.getTermFragment(term, idx)\n              )}\n            {termsCatalogSearchTermFiltered.length + termsChecked.length >=\n              maxTerms && <div className=\"ml-1\">...</div>}\n          </Form>\n          {errorMsg && <Alert color=\"danger\">{errorMsg}</Alert>}\n        </ModalBody>\n        <ModalFooter>\n          <Button\n            color=\"primary\"\n            className=\"w-9\"\n            onClick={this.handleApply}\n            disabled={!isSubmitBtnActive}\n          >\n            {gettext(\"Apply\")}\n          </Button>\n          <Button\n            className=\"ml-4\"\n            color=\"primary\"\n            onClick={this.handleCleanAll}\n          >\n            {gettext(\"Reset\")}\n          </Button>\n          <Button className=\"ml-4\" color=\"secondary\" onClick={this.toggle}>\n            {gettext(\"Cancel\")}\n          </Button>\n        </ModalFooter>\n      </Modal>\n    );\n  }\n}\n\nKeeperCatalogFacetDialog.propTypes = propTypes;\n\nexport default KeeperCatalogFacetDialog;\n","import React, { Fragment } from \"react\";\nimport { Form, FormGroup, Input } from \"reactstrap\";\nimport ReactDOM from \"react-dom\";\nimport { navigate } from \"@reach/router\";\nimport { Utils } from \"./utils/utils\";\nimport {\n  gettext,\n  logoHeight,\n  logoPath,\n  logoWidth,\n  mediaUrl,\n  siteRoot,\n  siteTitle,\n} from \"./utils/constants\";\nimport { keeperAPI } from \"./utils/seafile-api\";\nimport Loading from \"./components/loading\";\nimport Paginator from \"./components/paginator\";\nimport CommonToolbar from \"./components/toolbar/common-toolbar\";\nimport KeeperCatalogFacetDialog from \"./components/dialog/keeper-catalog-facet-dialog\";\n\nimport \"./css/toolbar.css\";\nimport \"./css/search.css\";\n\nimport \"./css/keeper-project-catalog.css\";\n\nconst { repoID, repoName, userPerm } = window.app.pageOptions;\n\nconst maxDescLength = 500;\n\nconst defaultFacet = {\n  order: \"asc\",\n  termEntries: {},\n  termsChecked: [],\n};\n\nclass KeeperProjectCatalog extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      errorMsg: \"\",\n      currentPage: 1,\n      perPage: 25,\n      hasNextPage: false,\n      items: [],\n      catalogScope: [],\n      searchTerm: \"\",\n      isAuthorFacetDialogOpen: false,\n      isYearFacetDialogOpen: false,\n      isInstituteFacetDialogOpen: false,\n      isDirectorFacetDialogOpen: false,\n      hasTermsChecked: false,\n    };\n    this.doResetFacets();\n  }\n\n  componentDidMount() {\n    let urlParams = new URL(window.location).searchParams;\n    const { currentPage, perPage } = this.state;\n    this.setState(\n      {\n        perPage: parseInt(urlParams.get(\"per_page\") || perPage),\n        currentPage: parseInt(urlParams.get(\"page\") || currentPage),\n      },\n      () => {\n        this.getItems(this.state.currentPage, true);\n      }\n    );\n    const script = document.createElement(\"script\");\n    script.src =\n      \"https://static.zdassets.com/ekr/snippet.js?key=32977f9b-455d-428b-8dd5-f4c65aad0daa\";\n    script.id = \"ze-snippet\";\n    script.async = true;\n    document.body.appendChild(script);\n  }\n\n  doResetFacets = () => {\n    this.state.facets = {\n      author: { ...defaultFacet },\n      year: { ...defaultFacet },\n      institute: { ...defaultFacet },\n      director: { ...defaultFacet },\n    };\n  };\n\n  calculateScopeFromFacets = () => {\n    let fs = this.state.facets;\n    // intersection\n    let scope = new Set();\n    for (let fkey of Object.keys(fs)) {\n      let f = fs[fkey];\n      if (\"termsChecked\" in f && f.termsChecked.length > 0) {\n        for (let tc of f.termsChecked) {\n          for (let e of f.termEntries[tc]) scope.add(e);\n        }\n      }\n    }\n    return Array.from(scope);\n  };\n\n  updateFacets = (newFs, reset) => {\n    let f = {};\n    for (let fkey of Object.keys(newFs)) {\n      let oldFs = this.state.facets[fkey].termEntries;\n      f[fkey] = {\n        ...this.state.facets[fkey],\n        // newer override oldFs if it is already initialized from DB\n        // TODO: check case: somebody changed catalog during the current search session\n        // check timestamp of latest\n        termEntries:\n          Object.keys(oldFs).length == 0 ? newFs[fkey].termEntries : oldFs,\n        termsChecked: newFs[fkey].termsChecked,\n      };\n    }\n    //    console.log(f)\n    return f;\n  };\n\n  getItems = (page, resetScope) => {\n    // this.setState({isLoading: true})\n    this.setHasTermsChecked();\n    let st = this.state;\n    let fs = this.state.facets;\n    let scope = resetScope ? [] : this.calculateScopeFromFacets();\n    keeperAPI\n      .getProjectCatalog(\n        page,\n        st.perPage,\n        fs.author,\n        fs.year,\n        fs.institute,\n        fs.director,\n        scope,\n        st.searchTerm\n      )\n      .then((res) => {\n        let d = res.data;\n        //console.log(d.items);\n        this.setState({\n          isLoading: false,\n          currentPage: page,\n          items: d.items,\n          hasNextPage: d.more,\n          catalogScope: d.scope,\n          facets: this.updateFacets(d.facets),\n          isAccessDenied: \"is_access_denied\" in d && d.is_access_denied,\n        });\n      })\n      .catch((error) => {\n        this.setState({\n          isLoading: false,\n          errorMsg: Utils.getErrorMsg(error, true), // true: show login tip if 403\n        });\n      });\n  };\n\n  resetPerPage = (perPage) => {\n    this.setState(\n      {\n        perPage: perPage,\n      },\n      () => {\n        this.getItems(1, false);\n      }\n    );\n  };\n\n  _chk = (f) => {\n    return f && \"termsChecked\" in f && f.termsChecked.length > 0;\n  };\n\n  setHasTermsChecked = () => {\n    let fs = this.state.facets;\n    this.setState({\n      hasTermsChecked:\n        this._chk(fs.author) ||\n        this._chk(fs.year) ||\n        this._chk(fs.director) ||\n        this._chk(fs.institute),\n    });\n  };\n\n  applyFacet = (fkey, termsChecked, order) => {\n    this.setState(\n      {\n        facets: {\n          ...this.state.facets,\n          [fkey]: {\n            ...this.state.facets[fkey],\n            termsChecked: termsChecked,\n            order: order,\n          },\n        },\n      },\n      () => {\n        this.getItems(1, termsChecked && termsChecked.length == 0);\n      }\n    );\n  };\n\n  cleanAllFacets = () => {\n    this.doResetFacets();\n    this.getItems(1, true);\n  };\n\n  onSearchedClick = (selectedItem) => {\n    if (selectedItem.is_dir === true) {\n      let url =\n        siteRoot +\n        \"library/\" +\n        selectedItem.repo_id +\n        \"/\" +\n        selectedItem.repo_name +\n        selectedItem.path;\n      navigate(url, { repalce: true });\n    } else {\n      let url =\n        siteRoot +\n        \"lib/\" +\n        selectedItem.repo_id +\n        \"/file\" +\n        Utils.encodePath(selectedItem.path);\n      let newWindow = window.open(\"about:blank\");\n      newWindow.location.href = url;\n    }\n  };\n\n  toggleAuthorFacetDialog = () => {\n    this.setState({\n      isAuthorFacetDialogOpen: !this.state.isAuthorFacetDialogOpen,\n    });\n  };\n\n  toggleYearFacetDialog = () => {\n    this.setState({ isYearFacetDialogOpen: !this.state.isYearFacetDialogOpen });\n  };\n\n  toggleInstituteFacetDialog = () => {\n    this.setState({\n      isInstituteFacetDialogOpen: !this.state.isInstituteFacetDialogOpen,\n    });\n  };\n\n  toggleDirectorFacetDialog = () => {\n    this.setState({\n      isDirectorFacetDialogOpen: !this.state.isDirectorFacetDialogOpen,\n    });\n  };\n\n  inputSearchTerm = (e) => {\n    this.setState({ searchTerm: e.target.value }, () => {\n      this.getItems(1, true);\n    });\n  };\n\n  getFacetFragment = (fkey) => {\n    let f = this.state.facets[fkey];\n    return (\n      <Fragment>\n        <a href=\"#\" style={{ color: \"#575859\", fontWeight: \"lighter\" }}>\n          {gettext(fkey.charAt(0).toUpperCase() + fkey.slice(1))}\n        </a>\n        {f.termsChecked.length > 0 && (\n          <i\n            className={\n              \"ml-1 fa fa-arrow-\" + (f.order == \"desc\" ? \"up\" : \"down\")\n            }\n          />\n        )}\n        <ul>\n          {f.termsChecked.map(\n            (t, idx) =>\n              t in f.termEntries && (\n                <Fragment key={`${t}~${idx}`}>\n                  <li className=\"ml-5 mb-0\">\n                    {t +\n                      (t in f.termEntries\n                        ? \" (\" + f.termEntries[t].length + \")\"\n                        : \"\")}\n                  </li>\n                </Fragment>\n              )\n          )}\n        </ul>\n      </Fragment>\n    );\n  };\n\n  render() {\n    const {\n      isAuthorFacetDialogOpen,\n      isYearFacetDialogOpen,\n      isInstituteFacetDialogOpen,\n      isDirectorFacetDialogOpen,\n      facets,\n      searchTerm,\n    } = this.state;\n    const hasSearchTerm = Boolean(searchTerm && searchTerm.trim() != \"\");\n    return (\n      <Fragment>\n        <div className=\"h-100 d-flex flex-column\">\n          <div className=\"top-header d-flex justify-content-between\">\n            <a href={siteRoot}>\n              <img\n                src={mediaUrl + logoPath}\n                height={logoHeight}\n                width={logoWidth}\n                title={siteTitle}\n                alt=\"logo\"\n              />\n            </a>\n            <CommonToolbar onSearchedClick={this.onSearchedClick} />\n          </div>\n          <div className=\"flex-auto container-fluid pt-4 pb-6 o-auto\">\n            <div className=\"row\">\n              {this.state.isAccessDenied ? (\n                <h3 className=\"offset-md-2 col-md-8 mt-9 text-center error\">\n                  {gettext(\n                    \"Sie sind leider nicht berechtigt den Projektkatalog zu öffnen. Bitte wenden Sie sich an den Keeper Support.\"\n                  )}\n                </h3>\n              ) : (\n                <div className=\"col-md-8 offset-md-2\">\n                  <h3 className=\"d-flex offset-md-3\" id=\"header\">\n                    {gettext(\n                      \"The KEEPER Project Catalog of the Max Planck Society\"\n                    )}\n                  </h3>\n                  <div className=\"row\">\n                    <div id=\"facet\" className=\"col-md-3\">\n                      <h3\n                        style={{\n                          color: \"#57a5b8\",\n                          fontSize: \"1.75em\",\n                          fontWeight: 500,\n                        }}\n                      >\n                        {gettext(\"Show Projects\")} (\n                        {this.state.catalogScope.length})\n                      </h3>\n                      <div onClick={this.toggleAuthorFacetDialog}>\n                        {this.getFacetFragment(\"author\")}\n                      </div>\n                      <div onClick={this.toggleYearFacetDialog}>\n                        {this.getFacetFragment(\"year\")}\n                      </div>\n                      <div onClick={this.toggleInstituteFacetDialog}>\n                        {this.getFacetFragment(\"institute\")}\n                      </div>\n                      <div onClick={this.toggleDirectorFacetDialog}>\n                        {this.getFacetFragment(\"director\")}\n                      </div>\n                      {this.state.hasTermsChecked && (\n                        <div className=\"mt-1\">\n                          <a href=\"#\" onClick={this.cleanAllFacets}>\n                            {gettext(\"Reset all\")}\n                          </a>\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"col-md-9\">\n                      <Form>\n                        <FormGroup>\n                          <Input\n                            type=\"search\"\n                            style={{ height: \"60%\" }}\n                            placeholder={gettext(\"Search\") + \"...\"}\n                            value={this.state.searchTerm}\n                            onChange={this.inputSearchTerm}\n                          />\n                        </FormGroup>\n                      </Form>\n                      <Content\n                        isLoading={this.state.isLoading}\n                        errorMsg={this.state.errorMsg}\n                        items={this.state.items}\n                      />\n                    </div>\n                  </div>\n                  <div className=\"row justify-content-center\">\n                    <Paginator\n                      gotoPreviousPage={() => {\n                        this.getItems(this.state.currentPage - 1, false);\n                      }}\n                      gotoNextPage={() => {\n                        this.getItems(this.state.currentPage + 1, false);\n                      }}\n                      currentPage={this.state.currentPage}\n                      hasNextPage={this.state.hasNextPage}\n                      curPerPage={this.state.perPage}\n                      resetPerPage={this.resetPerPage}\n                    />\n                  </div>\n                  <Footer />\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n        {isAuthorFacetDialogOpen && (\n          <KeeperCatalogFacetDialog\n            name={\"author\"}\n            values={facets.author}\n            hasCatalogSearchTerm={hasSearchTerm}\n            catalogScope={this.state.catalogScope}\n            toggleDialog={this.toggleAuthorFacetDialog}\n            applyFacet={this.applyFacet}\n          />\n        )}\n        {isYearFacetDialogOpen && (\n          <KeeperCatalogFacetDialog\n            name={\"year\"}\n            values={facets.year}\n            hasCatalogSearchTerm={hasSearchTerm}\n            catalogScope={this.state.catalogScope}\n            toggleDialog={this.toggleYearFacetDialog}\n            applyFacet={this.applyFacet}\n          />\n        )}\n        {isInstituteFacetDialogOpen && (\n          <KeeperCatalogFacetDialog\n            name={\"institute\"}\n            values={facets.institute}\n            hasCatalogSearchTerm={hasSearchTerm}\n            catalogScope={this.state.catalogScope}\n            toggleDialog={this.toggleInstituteFacetDialog}\n            applyFacet={this.applyFacet}\n          />\n        )}\n        {isDirectorFacetDialogOpen && (\n          <KeeperCatalogFacetDialog\n            name={\"director\"}\n            values={facets.director}\n            hasCatalogSearchTerm={hasSearchTerm}\n            catalogScope={this.state.catalogScope}\n            toggleDialog={this.toggleDirectorFacetDialog}\n            applyFacet={this.applyFacet}\n          />\n        )}\n      </Fragment>\n    );\n  }\n}\n\nclass Content extends React.Component {\n  render() {\n    const { isLoading, errorMsg, items } = this.props;\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <p className=\"error mt-6 text-center\">{errorMsg}</p>;\n    }\n\n    return (\n      <Fragment>\n        {items.map((item, index) => {\n          return <Item key={index} item={item} />;\n        })}\n      </Fragment>\n    );\n  }\n}\n\nclass Item extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      descExpanded: false,\n    };\n  }\n\n  toggleDescription = () => {\n    this.setState({ descExpanded: !this.state.descExpanded });\n  };\n\n  toTitleCase = (txt) => {\n    let str = txt.replace(/([^\\W_]+[^\\s-]*) */g, (t) => {\n      return t.charAt(0).toUpperCase() + t.substr(1).toLowerCase();\n    });\n    return str;\n  };\n\n  getAuthors = (item) => {\n    let author = [];\n    if (\"authors\" in item && item.authors.length > 0) {\n      let authors = item.authors;\n      for (let j = 0; j < authors.length; j++) {\n        let tauthor = \"\";\n        let tauthors = this.toTitleCase(authors[j].name).split(\", \");\n        for (let i = 0; i < tauthors.length; i++) {\n          if (i == 0 && tauthors[i].trim().length) {\n            tauthor += tauthors[i] + \", \";\n          } else if (tauthors[i].trim().length > 1)\n            tauthor += tauthors[i].trim().charAt(0) + \"., \";\n        }\n        tauthor = tauthor.trim().slice(0, -1);\n        if (j >= 5) tauthor = \"et al.\";\n        author.push(tauthor);\n        if (j >= 5) break;\n        if (\"affs\" in authors[j])\n          author.push(this.toTitleCase(authors[j].affs.join(\", \")));\n      }\n    }\n    return author.join(\"; \");\n  };\n\n  //TODO\n  getDirectors = (str) => {\n    let dirs = str\n      .split(\"|\")\n      .map((s) => s.trim())\n      .filter((s) => s.length > 0);\n    if (dirs.length > 0) {\n      return dirs.join(\"; \");\n    }\n    return null;\n  };\n\n  instituteFragment = (ins) => {\n    const split = ins\n      .split(\";\")\n      .map((s) => s.trim())\n      .filter((s) => s.length > 0);\n    if (!(split && split.length && split.length > 0)) return;\n\n    const dirs = split.length >= 3 ? this.getDirectors(split[2]) : null;\n    return (\n      <Fragment>\n        {split[0] && <p>{gettext(\"Institute\") + \": \" + split[0]}</p>}\n        {split[1] && <p>{gettext(\"Department\") + \": \" + split[1]}</p>}\n        {/*{dirs &&*/}\n        {/*  <p>{gettext(\"Directors or PIs\") + \": \" + dirs}</p>*/}\n        {/*}*/}\n      </Fragment>\n    );\n  };\n\n  render() {\n    const item = this.props.item;\n    let showExpandDesc =\n      item.description && item.description.length > maxDescLength;\n    return (\n      <Fragment>\n        <div className=\"item-block\" id={item.repo_id}>\n          <div className=\"row\">\n            <div className=\"col-md-1\">\n              {item.is_certified && <img src=\"/media/custom/certified.png\" />}\n            </div>\n            <div className=\"col-md-11\">\n              <h3>\n                {item.landing_page_url ? (\n                  <a href={\"/landing-page/libs/\" + item.repo_id + \"/\"}>\n                    {item.title}\n                  </a>\n                ) : (\n                  item.title ||\n                  gettext(\"Project archive no.\") + \": \" + item.catalog_id\n                )}\n              </h3>\n              {item.description && (\n                <p>\n                  {showExpandDesc\n                    ? !this.state.descExpanded\n                      ? item.description.substring(0, maxDescLength - 4) + \"...\"\n                      : item.description\n                    : item.description}\n                  {showExpandDesc && (\n                    <i\n                      onClick={this.toggleDescription}\n                      className={\n                        \"keeper-icon-triangle-\" +\n                        (this.state.descExpanded ? \"up\" : \"down\")\n                      }\n                    />\n                  )}\n                </p>\n              )}\n              {item.authors && <p>{this.getAuthors(item)}</p>}\n              {item.year && <p>{gettext(\"Year\") + \": \" + item.year}</p>}\n              {item.institute && this.instituteFragment(item.institute)}\n              {item.owner && (\n                <p>{gettext(\"Contact\") + \": \" + item.owner.toLowerCase()}</p>\n              )}\n              {item.landing_page_url && (\n                <p>\n                  <a href={\"/landing-page/libs/\" + item.repo_id + \"/\"}>\n                    {gettext(\"Landing Page\")}\n                  </a>\n                </p>\n              )}\n              {/*{JSON.stringify(item)}*/}\n            </div>\n          </div>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nclass Footer extends React.Component {\n  render() {\n    return (\n      <Fragment>\n        <div id=\"lg_footer\">\n          <div className=\"container\">\n            <div id=\"keeper-links\" className=\"row\">\n              <div className=\"col-md-3\">\n                <h4>Be informed</h4>\n                <a\n                  href=\"https://keeper.mpdl.mpg.de/f/d17ecbb967/\"\n                  target=\"_blank\"\n                >\n                  About Keeper\n                </a>\n                <br />\n                <a\n                  href=\"https://keeper.mpdl.mpg.de/f/1b0bfceac2/\"\n                  target=\"_blank\"\n                >\n                  Cared Data Commitment\n                </a>\n                <br />\n                <a href=\"/project-catalog\" target=\"_blank\">\n                  Project Catalog\n                </a>\n                <br />\n              </div>\n              <div className=\"col-md-3\">\n                <h4>Get the desktop sync client</h4>\n                <a href=\"/download_client_program/\" target=\"_blank\">\n                  Download the Keeper client for Windows, Linux and Mac\n                </a>\n              </div>\n              <div className=\"col-md-3\">\n                <h4>Find help</h4>\n                <a href=\"mailto:keeper@mpdl.mpg.de\">\n                  Contact Keeper Support\n                </a>{\" \"}\n                <br />\n                <a\n                  href=\"https://mpdl.zendesk.com/hc/en-us/categories/360001234340-Keeper\"\n                  target=\"_blank\"\n                >\n                  Help / Knowledge Base\n                </a>\n              </div>\n              <div className=\"col-md-3\">\n                <h4>Check terms</h4>\n                <a\n                  href=\"https://keeper.mpdl.mpg.de/f/f62758e53c/\"\n                  target=\"_blank\"\n                >\n                  Terms of Services\n                </a>{\" \"}\n                <br />\n                <a\n                  href=\"https://keeper.mpdl.mpg.de/f/17e4e9d648/\"\n                  target=\"_blank\"\n                >\n                  Disclaimer\n                </a>\n                <br />\n                <a\n                  href=\"https://keeper.mpdl.mpg.de/f/bf2c8a977f70428587eb/\"\n                  target=\"_blank\"\n                >\n                  Privacy Policy\n                </a>\n              </div>\n            </div>\n            <div id=\"seafile-credits\" className=\"row\">\n              <div className=\"col-md-12 text-center\">\n                <div>\n                  <a href=\"https://www.seafile.com/en/home/\" target=\"_blank\">\n                    The software behind Keeper{\" \"}\n                    <img\n                      id=\"seafile-logo\"\n                      src=\"/media/custom/seafile_logo_footer.png\"\n                      height=\"35\"\n                    />\n                    © 2023 Seafile\n                  </a>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nReactDOM.render(<KeeperProjectCatalog />, document.getElementById(\"wrapper\"));\n"],"sourceRoot":""}