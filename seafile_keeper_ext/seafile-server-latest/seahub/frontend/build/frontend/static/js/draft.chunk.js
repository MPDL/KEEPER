(this["webpackJsonpseahub-frontend"]=this["webpackJsonpseahub-frontend"]||[]).push([[7],{1509:function(e,t,n){n(52),e.exports=n(1707)},1510:function(e,t,n){"use strict";var i=n(617),a=n(618),s=n(1511),o=n(621),r=n(622),c=n(623);e.exports=function e(){var t=[],n=o(),b={},g=!1,O=-1;return w.data=function(e,t){if(r(e))return 2===arguments.length?(p("data",g),b[e]=t,w):d.call(b,e)&&b[e]||null;if(e)return p("data",g),b=e,w;return b},w.freeze=x,w.attachers=t,w.use=function(e){var n;if(p("use",g),null===e||void 0===e);else if("function"===typeof e)r.apply(null,arguments);else{if("object"!==typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?o(e):a(e)}n&&(b.settings=i(b.settings||{},n));return w;function a(e){o(e.plugins),e.settings&&(n=i(n||{},e.settings))}function s(e){if("function"===typeof e)r(e);else{if("object"!==typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?r.apply(null,e):a(e)}}function o(e){var t,n;if(null===e||void 0===e);else{if("object"!==typeof e||!("length"in e))throw new Error("Expected a list of plugins, not `"+e+"`");for(t=e.length,n=-1;++n<t;)s(e[n])}}function r(e,n){var a=C(e);a?(c(a[1])&&c(n)&&(n=i(a[1],n)),a[1]=n):t.push(l.call(arguments))}},w.parse=function(e){var t,n=s(e);if(x(),m("parse",t=w.Parser),f(t))return new t(String(n),n).parse();return t(String(n),n)},w.stringify=function(e,t){var n,i=s(t);if(x(),u("stringify",n=w.Compiler),v(e),f(n))return new n(e,i).compile();return n(e,i)},w.run=y,w.runSync=function(e,t){var n,i=!1;return y(e,t,s),j("runSync","run",i),n;function s(e,t){i=!0,a(e),n=t}},w.process=N,w.processSync=function(e){var t,n=!1;return x(),m("processSync",w.Parser),u("processSync",w.Compiler),N(t=s(e),i),j("processSync","process",n),t;function i(e){n=!0,a(e)}},w;function w(){for(var n=e(),a=t.length,s=-1;++s<a;)n.use.apply(null,t[s]);return n.data(i(!0,{},b)),n}function x(){var e,i,a,s;if(g)return w;for(;++O<t.length;)i=(e=t[O])[0],null,!1!==(a=e[1])&&(!0===a&&(e[1]=void 0),"function"===typeof(s=i.apply(w,e.slice(1)))&&n.use(s));return g=!0,O=1/0,w}function C(e){for(var n,i=t.length,a=-1;++a<i;)if((n=t[a])[0]===e)return n}function y(e,t,i){if(v(e),x(),i||"function"!==typeof t||(i=t,t=null),!i)return new Promise(a);function a(a,o){n.run(e,s(t),(function(t,n,s){n=n||e,t?o(t):a?a(n):i(null,n,s)}))}a(null,i)}function N(e,t){if(x(),m("process",w.Parser),u("process",w.Compiler),!t)return new Promise(n);function n(n,i){var a=s(e);h.run(w,{file:a},(function(e){e?i(e):n?n(a):t(null,a)}))}n(null,t)}}().freeze();var l=[].slice,d={}.hasOwnProperty,h=o().use((function(e,t){t.tree=e.parse(t.file)})).use((function(e,t,n){e.run(t.tree,t.file,(function(e,i,a){e?n(e):(t.tree=i,t.file=a,n())}))})).use((function(e,t){t.file.contents=e.stringify(t.tree,t.file)}));function f(e){return"function"===typeof e&&function(e){var t;for(t in e)return!0;return!1}(e.prototype)}function m(e,t){if("function"!==typeof t)throw new Error("Cannot `"+e+"` without `Parser`")}function u(e,t){if("function"!==typeof t)throw new Error("Cannot `"+e+"` without `Compiler`")}function p(e,t){if(t)throw new Error("Cannot invoke `"+e+"` on a frozen processor.\nCreate a new processor first, by invoking it: use `processor()` instead of `processor`.")}function v(e){if(!e||!r(e.type))throw new Error("Expected node, got `"+e+"`")}function j(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}},1511:function(e,t,n){"use strict";var i=n(619),a=n(1512);e.exports=a;var s=a.prototype;function o(e,t,n){var a=this.path,s=new i(e,t,n);return a&&(s.name=a+":"+s.name,s.file=a),s.fatal=!1,this.messages.push(s),s}s.message=o,s.info=function(){var e=this.message.apply(this,arguments);return e.fatal=null,e},s.fail=function(){var e=this.message.apply(this,arguments);throw e.fatal=!0,e},s.warn=o},1512:function(e,t,n){"use strict";(function(t){var i=n(422),a=n(620),s=n(1513);e.exports=l;var o={}.hasOwnProperty,r=l.prototype;r.toString=function(e){var t=this.contents||"";return s(t)?t.toString(e):String(t)};var c=["history","path","basename","stem","extname","dirname"];function l(e){var n,i,a;if(e){if("string"===typeof e||s(e))e={contents:e};else if("message"in e&&"messages"in e)return e}else e={};if(!(this instanceof l))return new l(e);for(this.data={},this.messages=[],this.history=[],this.cwd=t.cwd(),i=-1,a=c.length;++i<a;)n=c[i],o.call(e,n)&&(this[n]=e[n]);for(n in e)-1===c.indexOf(n)&&(this[n]=e[n])}function d(e,t){if(-1!==e.indexOf(i.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+i.sep+"`")}function h(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function f(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}Object.defineProperty(r,"path",{get:function(){return this.history[this.history.length-1]},set:function(e){h(e,"path"),e!==this.path&&this.history.push(e)}}),Object.defineProperty(r,"dirname",{get:function(){return"string"===typeof this.path?i.dirname(this.path):void 0},set:function(e){f(this.path,"dirname"),this.path=i.join(e||"",this.basename)}}),Object.defineProperty(r,"basename",{get:function(){return"string"===typeof this.path?i.basename(this.path):void 0},set:function(e){h(e,"basename"),d(e,"basename"),this.path=i.join(this.dirname||"",e)}}),Object.defineProperty(r,"extname",{get:function(){return"string"===typeof this.path?i.extname(this.path):void 0},set:function(e){var t=e||"";if(d(t,"extname"),f(this.path,"extname"),t){if("."!==t.charAt(0))throw new Error("`extname` must start with `.`");if(-1!==t.indexOf(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=a(this.path,t)}}),Object.defineProperty(r,"stem",{get:function(){return"string"===typeof this.path?i.basename(this.path,this.extname):void 0},set:function(e){h(e,"stem"),d(e,"stem"),this.path=i.join(this.dirname||"",e+(this.extname||""))}})}).call(this,n(146))},1513:function(e,t){e.exports=function(e){return null!=e&&null!=e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},1514:function(e,t,n){},1515:function(e,t,n){},1516:function(e,t,n){},1517:function(e,t,n){},1707:function(e,t,n){"use strict";n.r(t);var i=n(6),a=n(7),s=n(27),o=n(9),r=n(8),c=n(2),l=n.n(c),d=n(23),h=n.n(d),f=n(4),m=(n(152),n(1)),u=n(10),p=n(61),v=n.n(p),j=n(258),b=n(376),g=n(15),O=n(1510),w=n(427),x=n(650),C=n(651),y=n(652),N=n(658),D=n(662),S=n(106),I=n(674),R=n(682),k=n(444),_=n(683).default;var T=O().use(w,{commonmark:!0}).use(C).use(x).use(y,{allowDangerousHTML:!0}).use(D).use(N).use((function(e){var t=S(e,this.data("settings")),n=_(k,{attributes:{input:["type"],li:["className"],code:["className"]},tagNames:["input","code"]});this.Compiler=function(e){var i=R(e,n);return I(i,t)}})),E=(O().use(w,{commonmark:!0}).use(x),n(5)),M=n(11),L=(n(1514),n(0)),P=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).handleCommentChange=function(e){a.setState({comment:e.target.value})},a.submitComment=function(){var e=a.state.comment.trim();e.length>0&&(u.b.postComment(m.K,m.G,e).then((function(){a.props.listComments()})).catch((function(e){var t=E.a.getErrorMsg(e);M.a.danger(t)})),a.setState({comment:""}))},a.resolveComment=function(e){u.b.updateComment(m.K,e.target.id,"true").then((function(e){a.props.listComments()})).catch((function(e){var t=E.a.getErrorMsg(e);M.a.danger(t)}))},a.editComment=function(e,t){u.b.updateComment(m.K,e,null,null,t).then((function(e){a.props.listComments()})).catch((function(e){var t=E.a.getErrorMsg(e);M.a.danger(t)}))},a.toggleResolvedComment=function(){a.setState({showResolvedComment:!a.state.showResolvedComment})},a.deleteComment=function(e){u.b.deleteComment(m.K,e.target.id).then((function(e){a.props.listComments()})).catch((function(e){var t=E.a.getErrorMsg(e);M.a.danger(t)}))},a.onResizeMouseUp=function(){a.state.inResizing&&a.setState({inResizing:!1})},a.onResizeMouseDown=function(){a.setState({inResizing:!0})},a.onResizeMouseMove=function(e){var t=100-(e.nativeEvent.clientY-120)/a.refs.comment.clientHeight*100;if(t<20||t>70)return t<20&&a.setState({commentFooterHeight:25}),t>70&&a.setState({commentFooterHeight:65}),a.setState({inResizing:!1}),null;a.setState({commentFooterHeight:t})},a.scrollToQuote=function(e,t,n){a.props.scrollToQuote(e,t,n),a.setState({comment:""})},a.state={inResizing:!1,commentFooterHeight:25,showResolvedComment:!0,comment:""},a}return Object(a.a)(n,[{key:"componentWillReceiveProps",value:function(e){if(this.props.commentsList.length<e.commentsList.length){var t=this;setTimeout((function(){t.refs.commentsList.scrollTo(0,1e4)}),100)}}},{key:"render",value:function(){var e=this,t=this.state.inResizing?this.onResizeMouseMove:null,n=this.props.commentsList;return Object(L.jsxs)("div",{className:this.state.inResizing||this.props.inResizing?"seafile-comment seafile-comment-resizing":"seafile-comment",onMouseMove:t,onMouseUp:this.onResizeMouseUp,ref:"comment",children:[Object(L.jsxs)("div",{className:"seafile-comment-title",children:[Object(L.jsx)("div",{className:"seafile-comment-title-text",children:Object(m.jb)("Show resolved comments")}),Object(L.jsx)("div",{className:"seafile-comment-title-toggle",children:Object(L.jsxs)("label",{className:"custom-switch",id:"toggle-resolved-comments",children:[Object(L.jsx)("input",{type:"checkbox",name:"option",className:"custom-switch-input",onChange:this.toggleResolvedComment,checked:this.state.showResolvedComment&&"checked"}),Object(L.jsx)("span",{className:"custom-switch-indicator"})]})})]}),Object(L.jsxs)("div",{style:{height:100-this.state.commentFooterHeight+"%"},children:[0===n.length&&Object(L.jsx)("div",{className:"seafile-comment-list",children:Object(L.jsx)("div",{className:"comment-vacant",children:Object(m.jb)("No comment yet.")})}),Object(L.jsx)("ul",{className:"seafile-comment-list",ref:"commentsList",children:n.length>0&&n.map((function(t,n){return Object(L.jsx)(F,{item:t,showResolvedComment:e.state.showResolvedComment,resolveComment:e.resolveComment,editComment:e.editComment,scrollToQuote:e.scrollToQuote,deleteComment:e.deleteComment},n)}))})]}),Object(L.jsxs)("div",{className:"seafile-comment-footer",style:{height:this.state.commentFooterHeight+"%"},children:[Object(L.jsx)("div",{className:"seafile-comment-row-resize",onMouseDown:this.onResizeMouseDown}),Object(L.jsxs)("div",{className:"seafile-add-comment",children:[Object(L.jsx)("textarea",{className:"add-comment-input",value:this.state.comment,placeholder:Object(m.jb)("Add a comment."),onChange:this.handleCommentChange,clos:"100",rows:"3",warp:"virtual"}),Object(L.jsx)(f.c,{className:"comment-btn",color:"primary",size:"sm",onClick:this.submitComment,children:Object(m.jb)("Submit")})]})]})]})}}]),n}(l.a.Component),F=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).toggleDropDownMenu=function(){a.setState({dropdownOpen:!a.state.dropdownOpen})},a.convertComment=function(e){T.process(e.comment).then((function(e){var t=String(e);a.setState({comment:t})})),T.process(e.quote).then((function(e){var t=String(e);a.setState({quote:t})}))},a.scrollToQuote=function(){var e=a.props.item;a.props.scrollToQuote(e.newIndex,e.oldIndex,e.quote)},a.toggleEditComment=function(){a.setState({editable:!a.state.editable})},a.updateComment=function(e){var t=a.state.newComment;a.props.item.comment!==t&&a.props.editComment(e.target.id,t),a.toggleEditComment()},a.handleCommentChange=function(e){a.setState({newComment:e.target.value})},a.state={dropdownOpen:!1,comment:"",quote:"",newComment:a.props.item.comment,editable:!1},a}return Object(a.a)(n,[{key:"componentWillMount",value:function(){this.convertComment(this.props.item)}},{key:"componentWillReceiveProps",value:function(e){this.convertComment(e.item)}},{key:"render",value:function(){var e=this.props.item;return e.resolved&&!this.props.showResolvedComment?null:this.state.editable?Object(L.jsxs)("li",{className:"seafile-comment-item",id:e.id,children:[Object(L.jsxs)("div",{className:"seafile-comment-info",children:[Object(L.jsx)("img",{className:"avatar",src:e.avatarUrl,alt:""}),Object(L.jsxs)("div",{className:"reviewer-info",children:[Object(L.jsx)("div",{className:"reviewer-name ellipsis",children:e.name}),Object(L.jsx)("div",{className:"review-time",children:e.time})]})]}),Object(L.jsxs)("div",{className:"seafile-edit-comment",children:[Object(L.jsx)("textarea",{className:"edit-comment-input",value:this.state.newComment,onChange:this.handleCommentChange,clos:"100",rows:"3",warp:"virtual"}),Object(L.jsx)(f.c,{className:"comment-btn",color:"primary",size:"sm",onClick:this.updateComment,id:e.id,children:Object(m.jb)("Update")})," ",Object(L.jsx)(f.c,{className:"comment-btn",color:"secondary",size:"sm",onClick:this.toggleEditComment,children:Object(m.jb)("Cancel")})]})]}):Object(L.jsxs)("li",{className:e.resolved?"seafile-comment-item seafile-comment-item-resolved":"seafile-comment-item",id:e.id,children:[Object(L.jsxs)("div",{className:"seafile-comment-info",children:[Object(L.jsx)("img",{className:"avatar",src:e.avatarUrl,alt:""}),Object(L.jsxs)("div",{className:"reviewer-info",children:[Object(L.jsx)("div",{className:"reviewer-name ellipsis",children:e.name}),Object(L.jsx)("div",{className:"review-time",children:e.time})]}),!e.resolved&&Object(L.jsxs)(f.l,{isOpen:this.state.dropdownOpen,size:"sm",className:"seafile-comment-dropdown",toggle:this.toggleDropDownMenu,children:[Object(L.jsx)(f.o,{className:"seafile-comment-dropdown-btn",children:Object(L.jsx)("i",{className:"fas fa-ellipsis-v"})}),Object(L.jsxs)(f.n,{children:[e.userEmail===m.sc&&Object(L.jsx)(f.m,{onClick:this.props.deleteComment,className:"delete-comment",id:e.id,children:Object(m.jb)("Delete")}),e.userEmail===m.sc&&Object(L.jsx)(f.m,{onClick:this.toggleEditComment,className:"edit-comment",id:e.id,children:Object(m.jb)("Edit")}),Object(L.jsx)(f.m,{onClick:this.props.resolveComment,className:"seafile-comment-resolved",id:e.id,children:Object(m.jb)("Mark as resolved")})]})]})]}),e.newIndex>=-1&&e.oldIndex>=-1&&Object(L.jsx)("blockquote",{className:"seafile-comment-content",children:Object(L.jsx)("div",{onClick:this.scrollToQuote,dangerouslySetInnerHTML:{__html:this.state.quote}})}),Object(L.jsx)("div",{className:"seafile-comment-content",dangerouslySetInnerHTML:{__html:this.state.comment}})]})}}]),n}(l.a.Component),q=P,z=(n(1515),function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).handleCommentChange=function(e){var t=e.target.value;a.setState({comment:t})},a.submitComment=function(){var e=a.props,t=e.quote,n=e.newIndex,i=e.oldIndex,s=a.state.comment.trim();if(0!==s.length){if(t.length>0){var o={quote:t,newIndex:n,oldIndex:i};u.b.postComment(m.K,m.G,s,JSON.stringify(o)).then((function(){a.props.onCommentAdded()})).catch((function(e){var t=E.a.getErrorMsg(e);M.a.danger(t)}))}else u.b.postComment(m.K,m.G,s).then((function(){a.props.onCommentAdded()})).catch((function(e){var t=E.a.getErrorMsg(e);M.a.danger(t)}));a.setState({comment:""})}},a.setQuoteText=function(e){T.process(e).then((function(e){var t=String(e);a.setState({quote:t})}))},a.state={comment:"",quote:""},a}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.setQuoteText(this.props.quote)}},{key:"componentWillReceiveProps",value:function(e){this.props.quote!==e.quote&&this.setQuoteText(e.quote)}},{key:"render",value:function(){return Object(L.jsxs)("div",{className:"review-comment-dialog",children:[Object(L.jsx)("div",{children:m.Kb}),Object(L.jsx)("blockquote",{className:"review-comment-dialog-quote",children:Object(L.jsx)("div",{dangerouslySetInnerHTML:{__html:this.state.quote}})}),Object(L.jsx)("textarea",{value:this.state.comment,onChange:this.handleCommentChange}),Object(L.jsxs)("div",{className:"button-group",children:[Object(L.jsx)(f.c,{size:"sm",color:"primary",onClick:this.submitComment,children:Object(m.jb)("Submit")}),Object(L.jsx)(f.c,{size:"sm",color:"secondary",onClick:this.props.toggleCommentDialog,children:Object(m.jb)("Cancel")})]}),Object(L.jsx)("span",{className:"review-comment-dialog-triangle"})]})}}]),n}(l.a.Component)),A=n(54),H=(n(1516),function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).listReviewers=function(){u.b.listDraftReviewers(a.props.draftID).then((function(e){a.setState({reviewers:e.data.reviewers})}))},a.handleSelectChange=function(e){a.setState({selectedOption:e}),a.Options=[]},a.addReviewers=function(){if(a.state.selectedOption.length>0){a.refs.reviewSelect.clearSelect();for(var e=[],t=0;t<a.state.selectedOption.length;t++)e[t]=a.state.selectedOption[t].email;a.setState({loading:!0,errorMsg:[]}),u.b.addDraftReviewers(a.props.draftID,e).then((function(e){if(e.data.failed.length>0){for(var t=[],n=0;n<e.data.failed.length;n++)t[n]=e.data.failed[n];a.setState({errorMsg:t})}a.setState({selectedOption:null,loading:!1}),e.data.success.length>0&&a.listReviewers()})).catch((function(e){var t=E.a.getErrorMsg(e);M.a.danger(t)}))}},a.deleteReviewer=function(e){var t=e.target.getAttribute("name");u.b.deleteDraftReviewer(a.props.draftID,t).then((function(e){if(200===e.data){for(var n=[],i=0;i<a.state.reviewers.length;i++)a.state.reviewers[i].user_email!==t&&n.push(a.state.reviewers[i]);a.setState({reviewers:n})}})).catch((function(e){var t=E.a.getErrorMsg(e);M.a.danger(t)}))},a.state={reviewers:a.props.reviewers,selectedOption:null,errorMsg:[],loading:!1},a.Options=[],a}return Object(a.a)(n,[{key:"render",value:function(){var e=this,t=this.props.toggleAddReviewerDialog,n=this.state,i=n.reviewers,a=n.errorMsg;return Object(L.jsxs)(f.x,{isOpen:!0,toggle:t,children:[Object(L.jsx)(f.A,{toggle:t,children:Object(m.jb)("Request a review")}),Object(L.jsxs)(f.y,{children:[Object(L.jsx)("p",{children:Object(m.jb)("Add new reviewer")}),Object(L.jsxs)("div",{className:"add-reviewer",children:[Object(L.jsx)(A.a,{placeholder:Object(m.jb)("Search users..."),onSelectChange:this.handleSelectChange,ref:"reviewSelect",isMulti:!0,className:"reviewer-select"}),this.state.selectedOption&&!this.state.loading?Object(L.jsx)(f.c,{color:"secondary",onClick:this.addReviewers,children:Object(m.jb)("Submit")}):Object(L.jsx)(f.c,{color:"secondary",disabled:!0,children:Object(m.jb)("Submit")})]}),a.length>0&&a.map((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(L.jsxs)("p",{className:"reviewer-select-error error",children:[a[t].email,": ",a[t].error_msg]},t)})),i.length>0&&i.map((function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(L.jsxs)("div",{className:"reviewer-select-info",children:[Object(L.jsxs)("div",{className:"d-flex",children:[Object(L.jsx)("img",{className:"avatar reviewer-select-avatar",src:t.avatar_url,alt:""}),Object(L.jsx)("span",{className:"reviewer-select-name ellipsis",children:t.user_name})]}),Object(L.jsx)("i",{className:"fa fa-times",name:t.user_email,onClick:e.deleteReviewer})]},n)}))]}),Object(L.jsx)(f.z,{children:Object(L.jsx)(f.c,{color:"secondary",onClick:t,children:Object(m.jb)("Close")})})]})}}]),n}(l.a.Component)),K=n(63),U=n(14),B=n.n(U),G=n(51),Q=n(13),Y=n.n(Q);n(503);Y.a.locale(window.app.config.lang);var V=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).onClick=function(e,t,n,i){if(t===a.state.activeItem)return!1;a.props.onHistoryItemClick(i,n,t)},a.onScroll=function(e){var t=e.target.clientHeight,n=e.target.scrollHeight;if(t+e.target.scrollTop+1>=n&&a.props.totalReversionCount>a.perPage*a.state.currentPage){var i=a.state.currentPage+1;a.setState({currentPage:i,loading:!0}),u.b.listFileHistoryRecords(m.K,m.G,i,a.perPage).then((function(e){var t=Object.assign([],a.props.historyList);a.props.onHistoryListChange([].concat(Object(G.a)(t),Object(G.a)(e.data.data))),a.setState({loading:!1})})).catch((function(e){var t=E.a.getErrorMsg(e);M.a.danger(t)}))}},a.perPage=25,a.state={currentPage:1,loading:!1},a}return Object(a.a)(n,[{key:"render",value:function(){var e=this;return Object(L.jsx)("div",{className:"history-body",children:Object(L.jsxs)("ul",{onScroll:this.onScroll,className:"history-list-container",children:[this.props.historyList?this.props.historyList.map((function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,a=n+1;return a===i.length&&(a=n),Object(L.jsx)(W,{onClick:e.onClick,ctime:t.ctime,className:e.props.activeItem===n?"item-active":"",name:t.creator_name,index:n,preItem:i[a],currentItem:t},n)})):Object(L.jsx)(g.a,{}),this.state.loading&&Object(L.jsx)("li",{className:"reloading-reversion",children:Object(L.jsx)(g.a,{})})]})})}}]),n}(l.a.Component),W=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this,t=Y.a.parseZone(this.props.ctime).format("YYYY-MM-DD HH:mm");return Object(L.jsx)("li",{onClick:function(t){return e.props.onClick(t,e.props.index,e.props.preItem,e.props.currentItem)},className:"history-list-item "+this.props.className,children:Object(L.jsxs)("div",{className:"history-info",children:[Object(L.jsx)("div",{className:"time",children:t}),Object(L.jsxs)("div",{className:"owner",children:[Object(L.jsx)("i",{className:"squire-icon"}),Object(L.jsx)("span",{children:this.props.name})]})]})})}}]),n}(l.a.Component),J=V,X=n(12),Z=n(20),$=function e(t){Object(i.a)(this,e);var n=new Date(t.created_at).getTime();if(this.time=Y()(n).format("YYYY-MM-DD HH:mm"),this.id=t.id,this.avatarUrl=t.avatar_url,this.comment=t.comment,this.name=t.user_name,this.userEmail=t.user_email,this.resolved=t.resolved,t.detail){var a=JSON.parse(t.detail);this.newIndex=a.newIndex,this.oldIndex=a.oldIndex,this.quote=a.quote}};n(185),n(107),n(236),n(1517);n(278);var ee=n(499),te=n(13),ne=K.b.toSlateRange,ie=K.b.toDOMNode,ae=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).initialContent=function(){switch(m.L){case"open":if(!m.E)return void a.setState({isLoading:!1,isShowDiff:!1});if(!m.Ob)return void u.b.getFileDownloadLink(m.K,m.G).then((function(e){u.b.getFileContent(e.data).then((function(e){a.setState({draftContent:e.data,draftOriginContent:e.data,isLoading:!1,isShowDiff:!1})}))}));var e=window.location.hash;if(0===e.indexOf("#history-")){var t,n,i=e.slice(9,49),o=e.slice(50,90);a.setState({isLoading:!1,activeTab:"history"}),u.b.listFileHistoryRecords(m.K,m.G,1,25).then((function(e){var s=e.data.data;a.setState({historyList:s,totalReversionCount:e.data.total_count});for(var r=0,c=s.length;r<c&&(o===s[r].commit_id&&(a.setState({activeItem:r}),t=s[r].path),i===s[r].commit_id&&(n=s[r].path),!t||!n);r++);v.a.all([u.b.getFileRevision(m.K,i,n),u.b.getFileRevision(m.K,o,t)]).then(v.a.spread((function(e,t){v.a.all([u.b.getFileContent(e.data),u.b.getFileContent(t.data)]).then(v.a.spread((function(e,t){a.setDiffViewerContent(t.data,e.data)})))})))}))}else v.a.all([u.b.getFileDownloadLink(m.K,m.G),u.b.getFileDownloadLink(m.K,m.I)]).then(v.a.spread((function(e,t){v.a.all([u.b.getFileContent(e.data),u.b.getFileContent(t.data)]).then(v.a.spread((function(e,t){a.setState({draftContent:e.data,draftOriginContent:t.data,isLoading:!1});var n=Object(s.a)(a);setTimeout((function(){n.getChangedNodes()}),100)})))})));break;case"published":if(!m.Ob)return void a.setState({isLoading:!1,isShowDiff:!1});var r=m.hc+"repo/"+m.K+"/"+m.J+"/download?p="+m.I,c=m.hc+"repo/"+m.K+"/"+m.Pb+"/download?p="+m.I;v.a.all([u.b.getFileContent(r),u.b.getFileContent(c)]).then(v.a.spread((function(e,t){a.setState({draftContent:e.data,draftOriginContent:t.data,isLoading:!1})})))}},a.onHistoryItemClick=function(e,t,n){var i=t.commit_id,s=e.commit_id,o="history-"+i+"-"+s;a.setURL(o),a.setState({activeItem:n,isLoading:!0}),v.a.all([u.b.getFileRevision(m.K,s,e.path),u.b.getFileRevision(m.K,i,t.path)]).then(v.a.spread((function(e,t){v.a.all([u.b.getFileContent(e.data),u.b.getFileContent(t.data)]).then(v.a.spread((function(e,t){a.setDiffViewerContent(e.data,t.data)})))})))},a.onHistoryListChange=function(e){a.setState({historyList:e})},a.listComments=function(){u.b.listComments(m.K,m.G).then((function(e){var t=[];e.data.comments.forEach((function(e){t.push(new $(e))})),a.setState({commentsList:t})}))},a.addComment=function(e){e.stopPropagation(),a.getQuote(),a.quote&&a.setState({isShowCommentDialog:!0})},a.onCommentAdded=function(){a.listComments(),a.toggleCommentDialog()},a.toggleCommentDialog=function(){a.setState({isShowCommentDialog:!a.state.isShowCommentDialog})},a.getOriginRepoInfo=function(){u.b.getRepoInfo(m.K).then((function(e){a.setState({originRepoName:e.data.repo_name})}))},a.getDraftInfo=function(){"open"===m.L&&u.b.getFileInfo(m.K,m.G).then((function(e){a.setState({draftInfo:e.data})}))},a.getChangedNodes=function(){var e=a.refs.diffViewer.value,t=[],n="";e.map((function(e,i){var a=e.data.diff_state;("diff-added"===a&&"diff-added"!==n||"diff-removed"===a&&"diff-removed"!==n||"diff-replaced"===a&&"diff-replaced"!==n)&&t.push(i),n=e.data.diff_state})),a.setState({changedNodes:t})},a.scrollToChangedNode=function(e){if(0!=a.state.changedNodes.length){"up"===e?a.changeIndex++:a.changeIndex--,a.changeIndex>a.state.changedNodes.length-1&&(a.changeIndex=0),a.changeIndex<0&&(a.changeIndex=a.state.changedNodes.length-1);for(var t=window,n=a.state.changedNodes[a.changeIndex],i=window.viewer.children[n],s=ie(window.viewer,i);-1===s.className.indexOf("diff-")&&"BODY"!==s.tagName;)s=s.parentNode;var o=a.findScrollContainer(s,t);o==t.document.body||o==t.document.documentElement?t.scrollTo(0,s.offsetTop):o.scrollTop=s.offsetTop}},a.findScrollContainer=function(e,t){for(var n,i=e.parentNode,a=["auto","overlay","scroll"];!n&&i.parentNode;){var s=t.getComputedStyle(i).overflowY;if(a.includes(s)){n=i;break}i=i.parentNode}return n||t.document.body},a.scrollToQuote=function(e,t,n){var i=a.refs.diffViewer.value.find((function(n){if(n.data.old_index==t&&n.data.new_index==e)return n}));if(i){var s=ie(window.viewer,i);if(!s)return;var o=window,r=a.findScrollContainer(s,o);r==o.document.body||r==o.document.documentElement?o.scrollTo(0,s.offsetTop):r.scrollTop=s.offsetTop}},a.showDiffViewer=function(){return Object(L.jsxs)("div",{children:[a.state.isShowDiff?Object(L.jsx)(j.a,{scriptSource:m.Hb+"js/mathjax/tex-svg.js",newMarkdownContent:a.state.draftContent,oldMarkdownContent:a.state.draftOriginContent,ref:"diffViewer"}):Object(L.jsx)(j.a,{scriptSource:m.Hb+"js/mathjax/tex-svg.js",newMarkdownContent:a.state.draftContent,oldMarkdownContent:a.state.draftContent,ref:"diffViewer"}),Object(L.jsx)("i",{className:"fa fa-plus-square review-comment-btn",ref:"commentbtn",onMouseDown:a.addComment})]})},a.listReviewers=function(){u.b.listDraftReviewers(m.H).then((function(e){a.setState({reviewers:e.data.reviewers})}))},a.onSwitchShowDiff=function(){if(!a.state.isShowDiff){var e=Object(s.a)(a);setTimeout((function(){e.getChangedNodes()}),100)}a.setState({isShowDiff:!a.state.isShowDiff})},a.toggleDiffTip=function(){a.setState({showDiffTip:!a.state.showDiffTip})},a.toggleAddReviewerDialog=function(){a.state.showReviewerDialog&&a.listReviewers(),a.setState({showReviewerDialog:!a.state.showReviewerDialog})},a.showDiffButton=function(){return Object(L.jsxs)("div",{className:"seafile-toggle-diff",children:[Object(L.jsxs)("label",{className:"custom-switch",id:"toggle-diff",children:[Object(L.jsx)("input",{type:"checkbox",checked:a.state.isShowDiff&&"checked",name:"option",className:"custom-switch-input",onChange:a.onSwitchShowDiff}),Object(L.jsx)("span",{className:"custom-switch-indicator"})]}),Object(L.jsx)(f.K,{placement:"bottom",isOpen:a.state.showDiffTip,target:"toggle-diff",toggle:a.toggleDiffTip,children:Object(m.jb)("View diff")})]})},a.onPublishDraft=function(){u.b.publishDraft(m.H).then((function(e){a.setState({draftStatus:e.data.draft_status})}))},a.initialDiffViewerContent=function(){u.b.listFileHistoryRecords(m.K,m.G,1,25).then((function(e){a.setState({historyList:e.data.data,totalReversionCount:e.data.total_count}),e.data.data.length>1?v.a.all([u.b.getFileRevision(m.K,e.data.data[0].commit_id,m.G),u.b.getFileRevision(m.K,e.data.data[1].commit_id,m.G)]).then(v.a.spread((function(e,t){v.a.all([u.b.getFileContent(e.data),u.b.getFileContent(t.data)]).then(v.a.spread((function(e,t){a.setState({draftContent:e.data,draftOriginContent:t.data})})))}))):u.b.getFileRevision(m.K,e.data.data[0].commit_id,m.G).then((function(e){u.b.getFileContent(e.data).then((function(e){a.setState({draftContent:e.data,draftOriginContent:""})}))}))}))},a.setDiffViewerContent=function(e,t){a.setState({draftContent:e,draftOriginContent:t,isLoading:!1})},a.setURL=function(e){var t=new ee(window.location.href);t.set("hash",e),window.location.href=t.toString()},a.tabItemClick=function(e){a.state.activeTab!==e&&("history"!==e&&window.location.hash&&a.setURL("#"),"reviewInfo"==e?a.initialContent():"history"==e&&a.initialDiffViewerContent(),a.setState({activeTab:e}))},a.showNavItem=function(e){var t=a.state.commentsList.length;switch(e){case"info":return Object(L.jsx)(f.C,{className:"nav-item",children:Object(L.jsx)(f.D,{className:B()({active:"reviewInfo"===a.state.activeTab}),onClick:function(){a.tabItemClick("reviewInfo")},children:Object(L.jsx)("i",{className:"fas fa-info-circle"})})});case"comments":return Object(L.jsx)(f.C,{className:"nav-item",children:Object(L.jsxs)(f.D,{className:B()({active:"comments"===a.state.activeTab}),onClick:function(){a.tabItemClick("comments")},children:[Object(L.jsx)("i",{className:"fa fa-comments"}),t>0&&Object(L.jsx)("div",{className:"comments-number",children:t})]})});case"history":return Object(L.jsx)(f.C,{className:"nav-item",children:Object(L.jsx)(f.D,{className:B()({active:"history"===a.state.activeTab}),onClick:function(){a.tabItemClick("history")},children:Object(L.jsx)("i",{className:"fas fa-history"})})})}},a.getDomNodeByPath=function(e){for(var t,n=document.querySelector(".viewer-component");"number"===typeof e[0]&&n;)(t=n.children[e[0]]).getAttribute("data-slate-node")||(t=t.children[0]),e.shift(),n=t;return t},a.setBtnPosition=function(){var e=window.getSelection();if(e.rangeCount){var t=e.getRangeAt(0),n=null,i=a.refs.commentbtn.style;try{n=ne(window.viewer,t)}catch(r){return void(i.top="-1000px")}if(n&&!X.h.isCollapsed(n)){a.range=n;var s=n.anchor.path.slice();s.pop();var o=a.getDomNodeByPath(s);i.right="0px",i.top=o?"".concat(o.offsetTop,"px"):"-1000px"}else i.top="-1000px"}},a.getQuote=function(){if(a.range){a.quote=Object(b.a)(X.b.fragment(window.viewer,a.range));var e=window.viewer.children[a.range.anchor.path[0]];a.newIndex=e.data.new_index,a.oldIndex=e.data.old_index}},a.onResizeMouseUp=function(){a.state.inResizing&&a.setState({inResizing:!1})},a.onResizeMouseDown=function(){a.setState({inResizing:!0})},a.onResizeMouseMove=function(e){var t=100-e.nativeEvent.clientX/a.refs.main.clientWidth*100;if(t<20||t>60)return a.setState({inResizing:!1}),null;a.setState({rightPartWidth:t})},a.renderDiffButton=function(){switch(m.L){case"open":if(!m.E||!m.Ob)return;return a.showDiffButton();case"published":if(!m.Ob)return;return a.showDiffButton()}},a.renderNavItems=function(){switch(m.L){case"open":return m.E?Object(L.jsxs)(f.B,{tabs:!0,className:"review-side-panel-nav",children:[a.showNavItem("info"),a.showNavItem("comments"),a.showNavItem("history")]}):Object(L.jsx)(f.B,{tabs:!0,className:"review-side-panel-nav",children:a.showNavItem("info")});case"published":return m.Ob?Object(L.jsxs)(f.B,{tabs:!0,className:"review-side-panel-nav",children:[a.showNavItem("info"),a.showNavItem("comments")]}):Object(L.jsx)(f.B,{tabs:!0,className:"review-side-panel-nav",children:a.showNavItem("info")})}},a.renderContent=function(){switch(m.L){case"open":return m.E?a.showDiffViewer():Object(L.jsx)("p",{className:"error",children:Object(m.jb)("Draft has been deleted.")});case"published":return m.Ob?a.showDiffViewer():Object(L.jsx)("p",{className:"error",children:Object(m.jb)("Original file has been deleted.")})}},a.state={draftContent:"",draftOriginContent:"",draftInfo:{},isLoading:!0,isShowDiff:!0,showDiffTip:!1,activeTab:"reviewInfo",commentsList:[],changedNodes:[],originRepoName:"",isShowCommentDialog:!1,activeItem:null,historyList:[],showReviewerDialog:!1,reviewers:[],inResizing:!1,rightPartWidth:30,draftStatus:m.L},a.quote="",a.newIndex=null,a.oldIndex=null,a.changeIndex=-1,a.range=null,a}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.getOriginRepoInfo(),this.getDraftInfo(),this.listReviewers(),this.listComments(),this.initialContent(),document.addEventListener("selectionchange",this.setBtnPosition)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("selectionchange",this.setBtnPosition)}},{key:"render",value:function(){var e=this.state,t=e.draftInfo,n=e.reviewers,i=e.originRepoName,a=e.draftStatus,s=this.state.inResizing?this.onResizeMouseMove:null,o=m.hc+"lib/"+m.K+"/file"+m.G+"?mode=edit",r="published"==this.state.draftStatus,c="open"==this.state.draftStatus&&"rw"==m.gb,l="open"==this.state.draftStatus&&"rw"==m.gb,d=te(1e3*t.mtime).format("YYYY-MM-DD HH:mm"),h="".concat(m.hc,"profile/").concat(encodeURIComponent(t.last_modifier_email),"/");return Object(L.jsxs)("div",{className:"wrapper",children:[Object(L.jsxs)("div",{id:"header",className:"header review",children:[Object(L.jsxs)("div",{className:"cur-file-info",children:[Object(L.jsx)("div",{className:"info-item file-feature",children:Object(L.jsx)("span",{className:"sf2-icon-review"})}),Object(L.jsxs)("div",{children:[Object(L.jsxs)("div",{className:"info-item file-info",children:[Object(L.jsx)("span",{className:"file-name",children:m.F}),Object(L.jsx)("span",{className:"mx-2 file-review",children:Object(m.jb)("Review")})]}),!r&&t.mtime&&Object(L.jsxs)("div",{className:"last-modification",children:[Object(L.jsx)("a",{href:h,children:t.last_modifier_name}),Object(L.jsx)("span",{className:"mx-1",children:d})]})]})]}),Object(L.jsxs)("div",{className:"button-group",children:[this.renderDiffButton(),l&&Object(L.jsx)("a",{href:o,className:"mx-1",children:Object(L.jsx)(f.c,{className:"file-operation-btn",color:"secondary",children:Object(m.jb)("Edit Draft")})}),c&&Object(L.jsx)("button",{className:"btn btn-success file-operation-btn",title:Object(m.jb)("Publish draft"),onClick:this.onPublishDraft,children:Object(m.jb)("Publish")}),r&&Object(L.jsx)("button",{className:"btn btn-success file-operation-btn",title:Object(m.jb)("Published"),disabled:!0,children:Object(m.jb)("Published")})]})]}),Object(L.jsx)("div",{id:"main",className:"main",ref:"main",children:Object(L.jsxs)("div",{className:"cur-view-container",onMouseMove:s,onMouseUp:this.onResizeMouseUp,children:[Object(L.jsx)("div",{className:"cur-view-content",ref:"viewContent",style:{width:100-this.state.rightPartWidth+"%"},children:this.state.isLoading?Object(L.jsx)("div",{className:"markdown-viewer-render-content article",children:Object(L.jsx)(g.a,{})}):Object(L.jsx)("div",{className:"markdown-viewer-render-content article",children:this.renderContent()})}),Object(L.jsxs)("div",{className:"cur-view-right-part",style:{width:this.state.rightPartWidth+"%"},children:[Object(L.jsx)("div",{className:"seafile-comment-resize",onMouseDown:this.onResizeMouseDown}),Object(L.jsxs)("div",{className:"review-side-panel",children:[this.renderNavItems(),Object(L.jsxs)(f.H,{activeTab:this.state.activeTab,children:[Object(L.jsx)(f.I,{tabId:"reviewInfo",children:Object(L.jsxs)("div",{className:"review-side-panel-body",children:[Object(L.jsx)(se,{reviewers:n,toggleAddReviewerDialog:this.toggleAddReviewerDialog}),Object(L.jsx)(oe,{}),m.E&&Object(L.jsx)(ce,{commentsList:this.state.commentsList}),!0===this.state.isShowDiff&&this.state.changedNodes.length>0&&Object(L.jsx)(le,{changedNumber:this.state.changedNodes.length,scrollToChangedNode:this.scrollToChangedNode}),Object(L.jsx)(re,{originRepoName:i,draftInfo:t,draftStatus:a})]})}),Object(L.jsx)(f.I,{tabId:"comments",className:"comments",children:Object(L.jsx)(q,{scrollToQuote:this.scrollToQuote,listComments:this.listComments,commentsList:this.state.commentsList,inResizing:!1})}),Object(L.jsx)(f.I,{tabId:"history",className:"history",children:Object(L.jsx)(J,{activeItem:this.state.activeItem,historyList:this.state.historyList,totalReversionCount:this.state.totalReversionCount,onHistoryItemClick:this.onHistoryItemClick,onHistoryListChange:this.onHistoryListChange})})]})]})]})]})}),this.state.showReviewerDialog&&Object(L.jsx)(Z.a,{children:Object(L.jsx)(H,{showReviewerDialog:this.state.showReviewerDialog,toggleAddReviewerDialog:this.toggleAddReviewerDialog,draftID:m.H,reviewers:n})}),this.state.isShowCommentDialog&&Object(L.jsx)(Z.a,{children:Object(L.jsx)(z,{toggleCommentDialog:this.toggleCommentDialog,onCommentAdded:this.onCommentAdded,quote:this.quote,newIndex:this.newIndex,oldIndex:this.oldIndex})})]})}}]),n}(l.a.Component),se=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){return Object(i.a)(this,n),t.call(this,e)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props.reviewers;return Object(L.jsxs)("div",{className:"review-side-panel-item",children:[Object(L.jsxs)("div",{className:"review-side-panel-header",children:[Object(m.jb)("Reviewers"),Object(L.jsx)("i",{className:"fa fa-cog",onClick:this.props.toggleAddReviewerDialog})]}),e.length>0?e.map((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(L.jsxs)("div",{className:"reviewer-info",children:[Object(L.jsx)("img",{className:"avatar review-side-panel-avatar",src:e.avatar_url,alt:""}),Object(L.jsx)("span",{className:"reviewer-name ellipsis",children:e.user_name})]},t)})):Object(L.jsx)("span",{children:Object(m.jb)("No reviewer yet.")})]})}}]),n}(l.a.Component),oe=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{className:"review-side-panel-item",children:[Object(L.jsx)("div",{className:"review-side-panel-header",children:Object(m.jb)("Author")}),Object(L.jsxs)("div",{className:"author-info",children:[Object(L.jsx)("img",{className:"avatar review-side-panel-avatar",src:m.e,alt:""}),Object(L.jsx)("span",{className:"author-name ellipsis",children:m.d})]})]})}}]),n}(l.a.Component),re=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){return Object(i.a)(this,n),t.call(this,e)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props,t=e.draftStatus,n=e.originRepoName,i=m.Xb+"/lib/"+m.K+"/file"+m.I;return Object(L.jsx)("div",{className:"dirent-table-container",children:Object(L.jsxs)("table",{className:"table-thead-hidden",children:[Object(L.jsx)("thead",{children:Object(L.jsxs)("tr",{children:[Object(L.jsx)("th",{width:"25%"}),Object(L.jsx)("th",{width:"75%"})]})}),Object(L.jsx)("tbody",{children:Object(L.jsxs)("tr",{children:[Object(L.jsx)("th",{className:"align-text-top",children:Object(m.jb)("Location")}),Object(L.jsx)("td",{children:"open"===t?Object(L.jsxs)("span",{children:[n,m.G]}):Object(L.jsx)("a",{href:i,className:"text-dark",children:i})})]})})]})})}}]),n}(l.a.Component),ce=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){return Object(i.a)(this,n),t.call(this,e)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props.commentsList,t=0;if(e)for(var n=0,i=e.length;n<i;n++)!1===e[n].resolved&&t++;return Object(L.jsxs)("div",{className:"review-side-panel-item",children:[Object(L.jsx)("div",{className:"review-side-panel-header",children:Object(m.jb)("Comments")}),Object(L.jsx)("div",{className:"changes-info",children:Object(L.jsxs)("span",{children:[Object(m.jb)("Unresolved comments:")," ",t]})})]})}}]),n}(l.a.Component),le=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){return Object(i.a)(this,n),t.call(this,e)}return Object(a.a)(n,[{key:"render",value:function(){var e=this;return Object(L.jsxs)("div",{className:"review-side-panel-item",children:[Object(L.jsx)("div",{className:"review-side-panel-header",children:Object(m.jb)("Changes")}),Object(L.jsxs)("div",{className:"changes-info",children:[Object(L.jsxs)("span",{children:[Object(m.jb)("Number of changes:")," ",this.props.changedNumber]}),this.props.changedNumber>0&&Object(L.jsxs)("div",{children:[Object(L.jsx)("i",{className:"fa fa-arrow-circle-up",onClick:function(){e.props.scrollToChangedNode("down")}}),Object(L.jsx)("i",{className:"fa fa-arrow-circle-down",onClick:function(){e.props.scrollToChangedNode("up")}})]})]})]})}}]),n}(l.a.Component);h.a.render(Object(L.jsx)(ae,{}),document.getElementById("wrapper"))},258:function(e,t,n){"use strict";var i=n(16),a=n(19),s=n(21),o=n(22),r=n(2),c=n.n(r),l=(n(43),n(108)),d=n(41),h=n(112),f=n.n(h);function m(e,t){if(!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e.toUpperCase()===t.toUpperCase())return 1;if(1===e.length&&1===t.length)return 0;var n=v(e),i=v(t),a=n.length+i.length,s=0;return n.forEach((function(e){for(var t,n=0;t=i[n];n++)if(e===t){s++,i.splice(n,1);break}})),2*s/a}function u(e){return Array.isArray(e)?e.reduce((function(e,t){return e.concat(u(t))}),[]):[e]}function p(e){for(var t=[],n=0,i=e.length-1;n<i;n++)t[n]=e.substring(n,n+2);return t}function v(e){return u(e.toUpperCase().split(" ").map(p))}var j=n(12),b=n(53);function g(e,t){return e.type===t.type&&(!!f.a.isEqual(e,t)||(j.i.isText(e)&&j.i.isText(t)?m(e.text,t.text)>=.5&&"changed":(e.type===t.type&&(e.type.includes("ordered_list")||e.type.includes("unordered_list"))&&m(j.d.text(e),j.d.text(t))>=.5||e.type===t.type&&(e.children.length>1||t.children.length>1)&&"list_item"===e.type&&m(j.d.text(e),j.d.text(t))>=.5||e.type===t.type&&"paragraph"===e.type&&m(j.d.text(e),j.d.text(t))>=.5||e.type===t.type&&"table"===e.type&&m(j.d.text(e),j.d.text(t))>=.5||e.type===t.type&&"table_row"===e.type||e.type===t.type&&"table_cell"===e.type)&&"changed"))}function O(e,t){return e===t}var w=function(){function e(){var t=this;Object(i.a)(this,e),this.deepDiff=function(e,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=[],o=a+1,r=new C({equalFunc:i});r.ArrayDiff(e,n);for(var c=0;c<r.diff.length;c++){var l=r.diff[c],d=l.changeType;if("common"===d){var h={diff_state:"diff-common",new_index:l.newIndex,old_index:-1,node_depth:o};l.item.data=Object.assign(l.item.data?l.item.data:{},h)}else if("added"===d)if(j.i.isText(l.item))l.item.ADD=!0;else{var f={diff_state:"diff-added",new_index:l.newIndex,old_index:-1,node_depth:o};l.item.data=Object.assign(l.item.data?l.item.data:{},f)}else if("removed"===d)if(j.i.isText(l.item))l.item.DELETE=!0;else{var m={diff_state:"diff-removed",new_index:-1,old_index:l.oldIndex,node_depth:o};l.item.data=Object.assign(l.item.data?l.item.data:{},m)}else if("replaced"===d){var u=void 0,p=l.item.type||"text";if("text"===p?u=t.getTextDiff(l.newItem,l.oldItem):(p.includes("ordered_list")||p.includes("unordered_list")||p.includes("list_item")||"table"===p||"table_row"===p||"table_cell"===p||"paragraph"===p)&&(u=t.deepDiff(l.newItem.children,l.oldItem.children,i,o)),j.i.isText(l.item))l.item=u;else{var v={diff_state:"diff-replaced",new_index:-1,old_index:l.oldIndex,node_depth:o};l.item.data=Object.assign(l.item.data?l.item.data:{},v),l.item.children=u}}Array.isArray(l.item)?s=s.concat(l.item):s.push(l.item)}return s},this.getDiffDocument=function(e,n){var i=Object(b.a)(e),a=Object(b.a)(n),s=t.deepDiff(i,a,g);return s=t.splitTopDiffNodes(s)}}return Object(a.a)(e,[{key:"getTextDiff",value:function(e,t){var n=[],i=this.textDiff(e.text,t.text);return n=n.concat(i)}},{key:"textDiff",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=[],a=new C({equalFunc:O});a.StringDiff(e,t);var s=a.diff,o="",r=s[0].changeType;return s.forEach((function(e,t,a){var s="";"removed"===r?s="DELETE":"added"===r&&(s="ADD"),r===e.changeType?(o+=e.item,t===a.length-1&&i.push(Object(d.a)(Object(l.a)({text:o},s,!0),n))):e.changeType!==r&&(i.push(Object(d.a)(Object(d.a)({text:o},n),{},Object(l.a)({},s,!0))),r=e.changeType,o=e.item,t===a.length-1&&("removed"===r?s="DELETE":"added"===r&&(s="ADD"),i.push(Object(d.a)(Object(l.a)({text:o},s,!0),n))))})),i}},{key:"splitDiffParagraph",value:function(e){var t=f.a.cloneDeep(e),n=f.a.cloneDeep(e),i=[],a=[];return e.children.forEach((function(e,t,n){"link"===e.type||"image"===e.type?"diff-added"===e.data.diff_state?i.push(e):("diff-removed"===e.data.diff_state||i.push(e),a.push(e)):e.ADD?i.push(e):(e.DELETE||i.push(e),a.push(e))})),t.children=i,n.data.paragraph_state="old-paragraph",t.data.paragraph_state="new-paragraph",n.children=a,[n,t]}},{key:"splitTopDiffNodes",value:function(e){var t=this,n=[];return e.forEach((function(e){if("diff-replaced"===e.data.diff_state&&"paragraph"===e.type){var i=t.splitDiffParagraph(e);n.push(i[0],i[1])}else"diff-replaced"===e.data.diff_state&&"table"===e.type?(t.splitTableDiffParagraph(e),n.push(e)):n.push(e)})),n}},{key:"splitTableDiffParagraph",value:function(e){var t=this;return e.children.forEach((function(e,n,i){"diff-replaced"===e.data.diff_state&&e.children.forEach((function(e){if("diff-replaced"===e.data.diff_state&&"diff-replaced"===e.children[0].data.diff_state){var n=t.splitDiffParagraph(e.children[0]);e.children=n}}))})),e}}]),e}(),x=function(){function e(t,n,a){Object(i.a)(this,e),this.item=t,this.newIndex=n,this.oldIndex=a}return Object(a.a)(e,[{key:"added",value:function(){return void 0===this.oldIndex}},{key:"removed",value:function(){return void 0===this.newIndex}},{key:"common",value:function(){return void 0!==this.oldIndex&&void 0!==this.newIndex}}]),e}(),C=function(){function e(t){Object(i.a)(this,e),this.equalFunc=t.equalFunc?t.equalFunc:O,void 0!=t.shouldDetectChange?this.shouldDetectChange=t.shouldDetectChange:this.shouldDetectChange=!1,this.similarityFunc=t.similarityFunc}return Object(a.a)(e,[{key:"addAdded",value:function(e,t){var n=new x(e,t,void 0);n.changeType="added",this.added.push(n),this.diff.push(n)}},{key:"addRemoved",value:function(e,t){var n=new x(e,void 0,t);this.removed.push(n),n.changeType="removed",this.diff.push(n)}},{key:"addReplaced",value:function(e,t,n,i){var a=new x(e,i,n);a.newItem=t,a.oldItem=e,a.changeType="replaced",this.replaced.push(a),this.diff.push(a)}},{key:"addCommon",value:function(e,t,n,i){var a=new x(e,i,n);a.newItem=t,a.changeType="common",a.oldItem=e,this.common.push(a),this.diff.push(a)}},{key:"StringDiff",value:function(e,t){var n=e.length,i=t.length,a=0,s=0,o=[];for(o[n]=[],s=i;s>=0;o[n][s--]=0);for(a=n-1;a>=0;a--)for(o[a]=[],o[a][i]=0,s=i-1;s>=0;s--)this.equalFunc(e[a],t[s])?o[a][s]=o[a+1][s+1]+1:o[a][s]=Math.max(o[a+1][s],o[a][s+1]);for(this.common=[],this.added=[],this.removed=[],this.replaced=[],this.diff=[],a=s=0;a<n&&s<i;){if(this.equalFunc(e[a],t[s])){var r=e[a],c=t[s];this.addCommon(c,r,s,a),a++,s++}else o[a+1][s]>=o[a][s+1]?(this.addAdded(e[a],a),a++):(this.addRemoved(t[s],s),s++)}for(;a<n;a++)this.addAdded(e[a],a);for(;s<i;s++)this.addRemoved(t[s],s)}},{key:"ArrayDiff",value:function(e,t,n){var i=e.length,a=t.length,s=0,o=0,r=[];for(r[i]=[],o=a;o>=0;r[i][o--]=0);for(s=i-1;s>=0;s--)for(r[s]=[],r[s][a]=0,o=a-1;o>=0;o--)this.equalFunc(e[s],t[o])?r[s][o]=r[s+1][o+1]+1:r[s][o]=Math.max(r[s+1][o],r[s][o+1]);for(this.common=[],this.added=[],this.removed=[],this.replaced=[],this.diff=[],s=o=0;s<i&&o<a;){var c=this.equalFunc(e[s],t[o]);if(c){var l=e[s],d=t[o];"changed"===c?this.addReplaced(d,l,o,s):this.addCommon(d,l,o,s),n&&n("C",o,s),s++,o++}else r[s+1][o]>=r[s][o+1]?(this.addAdded(e[s],s),n&&n("A",0,s),s++):(this.addRemoved(t[o],o),n&&n("D",o,0),o++)}for(;s<i;s++)this.addAdded(e[s],s),n&&n("A",0,s);for(;o<a;o++)this.addRemoved(t[o],o),n&&n("D",o,0)}}]),e}(),y=n(75),N=n(219),D=n(157),S=(n(502),function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).renderDiffNode=function(e){var t=e.element,n=t.data?t.data:{},i=n.diff_state,a=n.node_depth;return"diff-added"===i?a>1?"blockquote"===t.type||"code_block"===t.type?c.a.createElement("div",{className:"diff-added-container"},Object(y.b)(e)):Object(y.b)(e):c.a.createElement("div",{className:"diff-added"},Object(y.b)(e)):"diff-removed"===i?a>1?"blockquote"===t.type||"code_block"===t.type?c.a.createElement("div",{className:"diff-removed-container"},Object(y.b)(e)):Object(y.b)(e):c.a.createElement("div",{className:"diff-removed"},Object(y.b)(e)):"diff-replaced"===i?a>1?Object(y.b)(e):c.a.createElement("div",{className:"diff-replaced"},Object(y.b)(e)):Object(y.b)(e)},a.value=[],a.slateDiff=new w,a}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props.newMarkdownContent,t=this.props.oldMarkdownContent;return this.value=this.slateDiff.getDiffDocument(e,t),c.a.createElement(D.a,{scriptSource:this.props.scriptSource},c.a.createElement(N.a,{style:{width:"100%"},renderDiffElement:this.renderDiffNode,renderDiffLeaf:y.a,value:this.value}))}}]),n}(c.a.PureComponent));t.a=S},502:function(e,t,n){},503:function(e,t,n){}},[[1509,1,0]]]);
//# sourceMappingURL=draft.chunk.js.map