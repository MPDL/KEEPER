{"version":3,"sources":["components/dialog/edit-repo-commit-labels.js","repo-history.js","components/dialog/commit-details.js"],"names":["UpdateRepoCommitLabels","props","handleInputChange","value","setState","inputValue","formSubmit","labels","state","map","item","index","join","repoID","commitID","submitBtnDisabled","seafileAPI","updateRepoCommitLabels","then","res","updateCommitLabels","data","revisionTags","tag","toggleDialog","toaster","success","gettext","catch","error","errorMsg","Utils","getErrorMsg","formErrorMsg","commitLabels","label","this","isOpen","centered","toggle","Fragment","defaultValue","isMulti","onChange","placeholder","className","disabled","onClick","React","Component","window","app","pageOptions","repoName","userPerm","showLabel","RepoHistory","getItems","page","getRepoHistory","perPage","isLoading","currentPage","items","hasNextPage","more","resetPerPage","onSearchedClick","selectedItem","is_dir","url","siteRoot","repo_id","repo_name","path","navigate","repalce","encodePath","open","location","href","goBack","e","preventDefault","history","back","urlParams","URL","searchParams","parseInt","get","src","mediaUrl","logoPath","height","logoHeight","width","logoWidth","title","siteTitle","alt","dangerouslySetInnerHTML","__html","generateDialogTitle","curPerPage","getListByPage","Content","getPreviousPage","getNextPage","theadData","text","isFirstCommit","showDetails","length","gotoPreviousPage","gotoNextPage","Item","handleMouseOver","isIconShown","handleMouseOut","showCommitDetails","isCommitDetailsDialogOpen","toggleCommitDetailsDialog","editLabel","isCommitLabelUpdateDialogOpen","toggleLabelEditDialog","updateLabels","tags","name","email","second_parent_id","encodeURIComponent","onMouseOver","onMouseOut","description","moment","time","format","client_version","device_name","commit_id","commitTime","ReactDOM","render","document","getElementById","CommitDetails","getCommitDetails","commitDetails","renderDetails","detailsData","type","showDesc","i","len","cmt_desc"],"mappings":"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","file":"static/js/repoHistory.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Modal, ModalHeader, ModalBody, ModalFooter } from 'reactstrap';\nimport CreatableSelect from 'react-select/lib/Creatable';\nimport { gettext } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\n\nconst propTypes = {\n  repoID: PropTypes.string.isRequired,\n  commitID: PropTypes.string.isRequired,\n  commitLabels: PropTypes.array.isRequired,\n  updateCommitLabels: PropTypes.func.isRequired,\n  toggleDialog: PropTypes.func.isRequired\n};\n\nclass UpdateRepoCommitLabels extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      inputValue: this.props.commitLabels.map((item, index) => {\n        return {label: item, value: item};\n      }),\n      submitBtnDisabled: false\n    };\n  }\n\n  handleInputChange = (value) => {\n    this.setState({\n      inputValue: value\n    });\n  }\n\n  formSubmit = () => {\n    const inputValue = this.state.inputValue;\n    const labels = inputValue.map((item, index) => item.value).join(',');\n    const {repoID, commitID} = this.props;\n\n    this.setState({\n      submitBtnDisabled: true\n    });\n\n    seafileAPI.updateRepoCommitLabels(repoID, commitID, labels).then((res) => {\n      this.props.updateCommitLabels(res.data.revisionTags.map((item, index) => item.tag));\n      this.props.toggleDialog();\n      toaster.success(gettext('Successfully edited labels.'));\n    }).catch((error) => {\n      let errorMsg = Utils.getErrorMsg(error);\n      this.setState({\n        formErrorMsg: errorMsg,\n        submitBtnDisabled: false\n      });\n    });\n  }\n\n  render() {\n    const { formErrorMsg } = this.state;\n    return (\n      <Modal isOpen={true} centered={true} toggle={this.props.toggleDialog}>\n        <ModalHeader toggle={this.props.toggleDialog}>{gettext('Edit labels')}</ModalHeader>\n        <ModalBody>\n          <React.Fragment>\n            <CreatableSelect\n              defaultValue={this.props.commitLabels.map((item, index) => { return {label: item, value: item}; })}\n              isMulti={true}\n              onChange={this.handleInputChange}\n              placeholder=''\n            />\n            {formErrorMsg && <p className=\"error m-0 mt-2\">{formErrorMsg}</p>}\n          </React.Fragment>\n        </ModalBody>\n        <ModalFooter>\n          <button className=\"btn btn-primary\" disabled={this.state.submitBtnDisabled} onClick={this.formSubmit}>{gettext('Submit')}</button>\n        </ModalFooter>\n      </Modal>\n    );\n  }\n}\n\nUpdateRepoCommitLabels.propTypes = propTypes;\n\nexport default UpdateRepoCommitLabels;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { navigate } from '@reach/router';\nimport moment from 'moment';\nimport { Utils } from './utils/utils';\nimport { gettext, siteRoot, mediaUrl, logoPath, logoWidth, logoHeight, siteTitle } from './utils/constants';\nimport { seafileAPI } from './utils/seafile-api';\nimport Loading from './components/loading';\nimport Paginator from './components/paginator';\nimport ModalPortal from './components/modal-portal';\nimport CommonToolbar from './components/toolbar/common-toolbar';\nimport CommitDetails from './components/dialog/commit-details';\nimport UpdateRepoCommitLabels from './components/dialog/edit-repo-commit-labels';\n\nimport './css/toolbar.css';\nimport './css/search.css';\n\nimport './css/repo-history.css';\n\nconst {\n  repoID,\n  repoName,\n  userPerm,\n  showLabel\n} = window.app.pageOptions;\n\nclass RepoHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      errorMsg: '',\n      currentPage: 1,\n      perPage: 25,\n      hasNextPage: false,\n      items: []\n    };\n  }\n\n  componentDidMount() {\n    let urlParams = (new URL(window.location)).searchParams;\n    const {\n      currentPage, perPage\n    } = this.state;\n    this.setState({\n      perPage: parseInt(urlParams.get('per_page') || perPage),\n      currentPage: parseInt(urlParams.get('page') || currentPage)\n    }, () => {\n      this.getItems(this.state.currentPage);\n    });\n  }\n\n  getItems = (page) => {\n    seafileAPI.getRepoHistory(repoID, page, this.state.perPage).then((res) => {\n      this.setState({\n        isLoading: false,\n        currentPage: page,\n        items: res.data.data,\n        hasNextPage: res.data.more\n      });\n    }).catch((error) => {\n      this.setState({\n        isLoading: false,\n        errorMsg: Utils.getErrorMsg(error, true) // true: show login tip if 403\n      });\n    });\n  }\n\n  resetPerPage = (perPage) => {\n    this.setState({\n      perPage: perPage\n    }, () => {\n      this.getItems(1);\n    });\n  }\n\n  onSearchedClick = (selectedItem) => {\n    if (selectedItem.is_dir === true) {\n      let url = siteRoot + 'library/' + selectedItem.repo_id + '/' + selectedItem.repo_name + selectedItem.path;\n      navigate(url, {repalce: true});\n    } else {\n      let url = siteRoot + 'lib/' + selectedItem.repo_id + '/file' + Utils.encodePath(selectedItem.path);\n      let newWindow = window.open('about:blank');\n      newWindow.location.href = url;\n    }\n  }\n\n  goBack = (e) => {\n    e.preventDefault();\n    window.history.back();\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        <div className=\"h-100 d-flex flex-column\">\n          <div className=\"top-header d-flex justify-content-between\">\n            <a href={siteRoot}>\n              <img src={mediaUrl + logoPath} height={logoHeight} width={logoWidth} title={siteTitle} alt=\"logo\" />\n            </a>\n            <CommonToolbar onSearchedClick={this.onSearchedClick} />\n          </div>\n          <div className=\"flex-auto container-fluid pt-4 pb-6 o-auto\">\n            <div className=\"row\">\n              <div className=\"col-md-10 offset-md-1\">\n                <h2 dangerouslySetInnerHTML={{__html: Utils.generateDialogTitle(gettext('{placeholder} Modification History'), repoName)}}></h2>\n                <a href=\"#\" className=\"go-back\" title={gettext('Back')} onClick={this.goBack}>\n                  <span className=\"fas fa-chevron-left\"></span>\n                </a>\n                {userPerm == 'rw' && <p className=\"tip\">{gettext('Tip: a snapshot will be generated after modification, which records the library state after the modification.')}</p>}\n                <Content\n                  isLoading={this.state.isLoading}\n                  errorMsg={this.state.errorMsg}\n                  items={this.state.items}\n                  currentPage={this.state.currentPage}\n                  hasNextPage={this.state.hasNextPage}\n                  curPerPage={this.state.perPage}\n                  resetPerPage={this.resetPerPage}\n                  getListByPage={this.getItems}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n\nclass Content extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.theadData = showLabel ? [\n      {width: '43%', text: gettext('Description')},\n      {width: '12%', text: gettext('Time')},\n      {width: '9%', text: gettext('Modifier')},\n      {width: '12%', text: `${gettext('Device')} / ${gettext('Version')}`},\n      {width: '12%', text: gettext('Labels')},\n      {width: '12%', text: ''}\n    ] : [\n      {width: '43%', text: gettext('Description')},\n      {width: '15%', text: gettext('Time')},\n      {width: '15%', text: gettext('Modifier')},\n      {width: '15%', text: `${gettext('Device')} / ${gettext('Version')}`},\n      {width: '12%', text: ''}\n    ];\n  }\n\n  getPreviousPage = () => {\n    this.props.getListByPage(this.props.currentPage - 1);\n  }\n\n  getNextPage = () => {\n    this.props.getListByPage(this.props.currentPage + 1);\n  }\n\n  render() {\n    const {\n      isLoading, errorMsg, items,\n      curPerPage, currentPage, hasNextPage\n    } = this.props;\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <p className=\"error mt-6 text-center\">{errorMsg}</p>;\n    }\n\n    return (\n      <React.Fragment>\n        <table className=\"table-hover\">\n          <thead>\n            <tr>\n              {this.theadData.map((item, index) => {\n                return <th key={index} width={item.width}>{item.text}</th>;\n              })}\n            </tr>\n          </thead>\n          <tbody>\n            {items.map((item, index) => {\n              item.isFirstCommit = (currentPage == 1) && (index == 0);\n              item.showDetails = hasNextPage || (index != items.length - 1);\n              return <Item key={index} item={item} />;\n            })}\n          </tbody>\n        </table>\n        <Paginator\n          gotoPreviousPage={this.getPreviousPage}\n          gotoNextPage={this.getNextPage}\n          currentPage={currentPage}\n          hasNextPage={hasNextPage}\n          curPerPage={curPerPage}\n          resetPerPage={this.props.resetPerPage}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nclass Item extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      labels: this.props.item.tags,\n      isIconShown: false,\n      isCommitLabelUpdateDialogOpen: false,\n      isCommitDetailsDialogOpen: false\n    };\n  }\n\n  handleMouseOver = () => {\n    this.setState({isIconShown: true});\n  }\n\n  handleMouseOut = () => {\n    this.setState({isIconShown: false});\n  }\n\n  showCommitDetails = (e) => {\n    e.preventDefault();\n    this.setState({\n      isCommitDetailsDialogOpen: !this.state.isCommitDetailsDialogOpen\n    });\n  }\n\n  toggleCommitDetailsDialog = () => {\n    this.setState({\n      isCommitDetailsDialogOpen: !this.state.isCommitDetailsDialogOpen\n    });\n  }\n\n  editLabel = () => {\n    this.setState({\n      isCommitLabelUpdateDialogOpen: !this.state.isCommitLabelUpdateDialogOpen\n    });\n  }\n\n  toggleLabelEditDialog = () => {\n    this.setState({\n      isCommitLabelUpdateDialogOpen: !this.state.isCommitLabelUpdateDialogOpen\n    });\n  }\n\n  updateLabels = (labels) => {\n    this.setState({\n      labels: labels\n    });\n  }\n\n  render() {\n    const item = this.props.item;\n    const { isIconShown, isCommitLabelUpdateDialogOpen, isCommitDetailsDialogOpen, labels } = this.state;\n\n    let name = '';\n    if (item.email) {\n      if (!item.second_parent_id) {\n        name = <a href={`${siteRoot}profile/${encodeURIComponent(item.email)}/`}>{item.name}</a>;\n      } else {\n        name = gettext('None');\n      }\n    } else {\n      name = gettext('Unknown');\n    }\n\n    return (\n      <React.Fragment>\n        <tr onMouseOver={this.handleMouseOver} onMouseOut={this.handleMouseOut}>\n          <td>\n            {item.description}\n            {item.showDetails &&\n            <a href=\"#\" className=\"details\" onClick={this.showCommitDetails}>{gettext('Details')}</a>\n            }\n          </td>\n          <td title={moment(item.time).format('LLLL')}>{moment(item.time).format('YYYY-MM-DD')}</td>\n          <td>{name}</td>\n          <td>\n            {item.client_version ? `${item.device_name} / ${item.client_version}` : 'API / --'}\n          </td>\n          {showLabel &&\n          <td>\n            {labels.map((item, index) => {\n              return <span key={index} className=\"commit-label\">{item}</span>;\n            })}\n            {userPerm == 'rw' &&\n            <span className={`attr-action-icon fa fa-pencil-alt ${isIconShown ? '': 'invisible'}`} title={gettext('Edit')} onClick={this.editLabel}></span>\n            }\n          </td>\n          }\n          <td>\n            {userPerm == 'rw' && (\n              item.isFirstCommit ?\n                <span className={isIconShown ? '': 'invisible'}>{gettext('Current Version')}</span> :\n                <a href={`${siteRoot}repo/${repoID}/snapshot/?commit_id=${item.commit_id}`} className={isIconShown ? '': 'invisible'}>{gettext('View Snapshot')}</a>\n            )}\n          </td>\n        </tr>\n        {isCommitDetailsDialogOpen &&\n          <ModalPortal>\n            <CommitDetails\n              repoID={repoID}\n              commitID={item.commit_id}\n              commitTime={item.time}\n              toggleDialog={this.toggleCommitDetailsDialog}\n            />\n          </ModalPortal>\n        }\n        {isCommitLabelUpdateDialogOpen &&\n          <ModalPortal>\n            <UpdateRepoCommitLabels\n              repoID={repoID}\n              commitID={item.commit_id}\n              commitLabels={labels}\n              updateCommitLabels={this.updateLabels}\n              toggleDialog={this.toggleLabelEditDialog}\n            />\n          </ModalPortal>\n        }\n      </React.Fragment>\n    );\n  }\n}\n\nReactDOM.render(\n  <RepoHistory />,\n  document.getElementById('wrapper')\n);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Modal, ModalHeader, ModalBody } from 'reactstrap';\nimport moment from 'moment';\nimport { gettext, fileServerRoot } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport Loading from '../loading';\n\nimport '../../css/commit-details.css';\n\nconst propTypes = {\n  repoID: PropTypes.string.isRequired,\n  commitID: PropTypes.string.isRequired,\n  commitTime: PropTypes.string.isRequired,\n  toggleDialog: PropTypes.func.isRequired\n};\n\nclass CommitDetails extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      errorMsg: '',\n    };\n  }\n\n  componentDidMount() {\n    const {repoID, commitID} = this.props;\n    seafileAPI.getCommitDetails(repoID, commitID).then((res) => {\n      this.setState({\n        isLoading: false,\n        errorMsg: '',\n        commitDetails: res.data\n      });\n    }).catch((error) => {\n      let errorMsg = Utils.getErrorMsg(error);\n      this.setState({\n        isLoading: false,\n        errorMsg: errorMsg\n      });\n    });\n  }\n\n  render() {\n    const { toggleDialog, commitTime} = this.props;\n    return (\n      <Modal isOpen={true} centered={true} toggle={toggleDialog}>\n        <ModalHeader toggle={toggleDialog}>{gettext('Modification Details')}</ModalHeader>\n        <ModalBody>\n          <p className=\"small\">{moment(this.props.commitTime).format('YYYY-MM-DD HH:mm:ss')}</p>\n          <Content data={this.state} />\n        </ModalBody>\n      </Modal>\n    );\n  }\n}\n\nclass Content extends React.Component {\n\n  renderDetails = (data) => {\n    const detailsData = [\n      {type: 'new', title: gettext('New files')},\n      {type: 'removed', title: gettext('Deleted files')},\n      {type: 'renamed', title: gettext('Renamed or Moved files')},\n      {type: 'modified', title: gettext('Modified files')},\n      {type: 'newdir', title: gettext('New directories')},\n      {type: 'deldir', title: gettext('Deleted directories')}\n    ];\n\n    let showDesc = true;\n    for (let i = 0, len = detailsData.length; i < len; i++) {\n      if (data[detailsData[i].type].length) {\n        showDesc = false;\n        break;\n      }\n    }\n    if (showDesc) {\n      return <p>{data.cmt_desc}</p>;\n    }\n\n    return (\n      <React.Fragment>\n        {detailsData.map((item, index) => {\n          if (!data[item.type].length) {\n            return;\n          }\n          return (\n            <React.Fragment key={index}>\n              <h6>{item.title}</h6>\n              <ul>\n                {\n                  data[item.type].map((item, index) => {\n                    return <li key={index} dangerouslySetInnerHTML={{__html: item}} className=\"commit-detail-item\"></li>;\n                  })\n                }\n              </ul>\n            </React.Fragment>\n          );\n        })}\n      </React.Fragment>\n    );\n  }\n\n  render() {\n    const {isLoading, errorMsg, commitDetails} = this.props.data;\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <p className=\"error mt-4 text-center\">{errorMsg}</p>;\n    }\n\n    return this.renderDetails(commitDetails);\n  }\n}\n\nCommitDetails.propTypes = propTypes;\n\nexport default CommitDetails;\n"],"sourceRoot":""}